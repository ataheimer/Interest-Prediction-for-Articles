t circumv storag limit variat data assimil studi a applic pontryagin maximum principl data assimil use blend possibl incomplet nonuniformli distribut spatiotempor observ data geophys model use extens engin control theori applic data assimil introduc rel recent meteorolog forecast naturalresourc recoveri model climat dynam variat data assimil promis assimil techniqu assum optim state system extrema care chosen cost function provid adjoint model avail requir model gradient comput integr model forward adjoint backward gradient use extrem cost function suitabl iter conjug gradient solverth problem address studi explos growth onlin comput memori remot storag requir comput gradient forwardadjoint techniqu character largescal assimil studi storag limit impos sever limit size assimil studi even largest comput use recurs strategi schedul construct enabl forwardadjoint model run perform way storag requir trade longer comput time gener applic strategi enabl data assimil studi significantli larger domain would otherwis possibl given particular hardwar constraint without compromis outcom way furthermor shown tradeoff inde viabl schedul optim storag comput time grow logarithm b introduct data assimil rel recent becom import tool mani area geophys weather climat forecast model sensitivitytoparamet studi inclus field data set theoret modelstudi weather forecast field data may spatial andor tempor heteregen continu blend dynam model soon field data avail result signific improv predict capabl today weather model ocean forecast thu far met compar success atmospher counterpart reason spatial tempor scale relev ocean dynam sever order magnitud smaller larger respect ocean data gather present limit coverag sometim incompat qualiti boundari flux airsea interfac poorli understood yet major influenc ocean flow lastli comput demand ocean forecast recent becom margin suitabl type studi reason resolut specif approach data assimil call variat data assimil object function defin provid norm distanc misfit state set observ data state set may compris model predict paramet boundari data andor initi condit misfit usual weight order account measur error model uncertainti etc object find state set extrem object function usual done constrain optim problem gener solv iter extent newton method descent algorithm optim problem requir comput gradient model respect state set one altern strategi accomplish calcul gradient adjoint method provid adjoint tangent linear model exist process comput gradient involv integr origin model forward time the forward problem record model histori use histori adjoint model integr backward time back point origin the adjoint problem along way partial differenti compris gradient result final respect state set particular time step multipli revers order adjoint model reach origin again chain rule multipl yield gradient comput cost roughli twice forward problem describ abov adjoint method call convent approach main advantag low comput cost howev disadvantag quickli encount comput memori storag problem even low resolut studi paper present altern convent approach circumv signific way storag problem adjoint method expens possibl greater manag comput expens problem motiv section altern gradient method present section compar convent approach section demonstr altern implement practic ocean climat problem describ compar convent approach term comput effort memori usag last section summar find provid detail strategi comput implement detail obtain code implement method statement problem sake clariti assum physic problem question model evolutionari equat physic mdimension real domain r boundari r discret evolut paramet physic time march accord ideltat goal find state set minim misfit equationtofielddata semidiscret forward problem complet partial unknown u v initi boundari data state set minim object function revers problem adjoint forward problem semidiscret evolut equat think u domain r theta vector state variabl adjoint time step index equat solv high level comput languag fortran c defin k set comput memori address requir repres vector set fug fu g index locat i u j u temporari memori locat j k respect assum call temporari comput storag medium regist let f f represent f f respect high level comput program program short take form subroutin function etc action f defin m t norm memori time execut program q kqkm kqk respect evid follow norm amount simpl direct sum regist memori state set safe assum ks km r type memori play import role analysi avail memori extern program usual extern storag devic memori disk tape etc simplic shall call record devic tape assum fix memori size distinct nonrecord program procedur f procedur record state set tape indic f conveni defin follow specif m t norm in in jm restrepo g k leaf a griewank maximum memori requir restor f given maximum comput time wallclock time execut f worth note essenti fix regardless number processor vari significantli depend number processor sinc f linear map assum refer respect analog norm f f cs posit multipl constant note kf k r sinc subroutin may requir work regist discret code typic evolut equat exampl climat metereolog problem identifi f collect subroutin function take state set time i forward integr kf km kf k approxim level thu equal respect fashion f collect subroutin take state set time revers integr kf approxim level thu equal respect let us consid memori time norm two strategi may use ngammastep gradient comput adjoint method one strategi minim memori norm achiev record noth tape requir step forward u un use f follow singl revers step un use f n start u forward ungamma use f follow revers f ungamma ungamma process repeat revers integr reach step again t m norm strategi respect regist memori use simplic ignor here on regist memori use work array etc explicit fourthord rungekutta time integr scheme exampl regist memori signific easili account estim provid anoth strategi convent approach step forward u un use step revers use f read appropri state variabl tape time memori norm latter strategi henc convent approach yield adjoint fix multipl time forward program howev tape grow linearli number step size state set typic geophys applic quickli overwhelm even largest storag capabl comput facil recurs adjoint method recurs strategi specif design circumv storag limit convent adjoint method expens larger comput effort comput effort defin precis below suffic know comput effort directli proport wallclock time turn depend number processor one strategi reduc tape size produc gradient use usual forwardadjoint sweep record less often realli requir altern save tape space produc degrad gradient shown gradient produc recurs method ident nondegrad counterpart obtain convent way descript follow present heurist explan theoret develop appear basi strategi limit tape size dr n snapshot snap short state fug given point program execut done care overrecord requir addit rfold increas addit full forward unrecord comput rep recurs strategi schedul uniqu howev theorem due griewank among partit algorithm binomi partit schedul optim theorem state nstep gradient calcul use adjoint method solv recurs use snap r rep dr note nd d n illustr sens method optim appeal stirl formula find fix r see clearli relationship n number snap rep contour plot ln n function number snap rep base appear figur sinc valu binomi take discret contour appear jag figur clearli illustr logarithm rate growth given particular grow log n schedul appear figur worth explain detail note along horizont number rep along vertic time step i tree structur schedul evid horizont line drawn locat record perform evid read figur left right jm restrepo g k leaf a griewank rep figur contour ln n versu snap rep r selfsimilar group pennant top pennant first execut snap record occur record time step execut requir forward sweep state restor forward sweep follow forwardadjoint back execut then first pennant complet swept repeat last two step adjoint reach state restor forward sweep follow record second upppermost triangl swept through state recov forward sweep follow record complet first pennant state restor forward sweep initi end record along way point schedul obviou last pennant perform note instant depth record record long addit tape thought stack order record maintain due lastinfirstout natur evid figur total forward record sweep adjoint revers sweep r forward unrecord sweep figur may conclud tnorm mnorm recurs schedul i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i i figur schedul are respect sinc dr first express right hand side equat hold gener nd r r recurs adjoint problem far right hand side gener recurs adjoint problem involv evolut equat typic encount climat metereolog studi also note number rep r sweep similar r log n jm restrepo g k leaf a griewank tabl schedul detail sever set d r n comparison lead work measur comput effort directli proport wallclock time conveni measur total number forward step shall employ measur follow section comparison recurs convent approach effect perform recurs method compar convent one may assess graphic figur illustr relat memori measur snap wallclock time assum proport effort convent approach repres leftmost curv curv repres differ snap rep combin convent well recurs case memori requir solv problem equal d defin depend resolut number spatial dimens problem effort hand convent case basic n recurs strategi depend choic snap rep left right recurs strategi curv correspond decreas number snap lineconnect curv lower corner correspond case snap rep equal convent case effect limit snap equal n recurs strategi surmiz curv reflect previouslyment characterist recurs method effort increas recurs method fewer snap use henc practic user want maxim number snap calcul rather number rep logeffortsnap figur convent versu recurs strategi comparison ad effort due increas rep r left right convent case curv repres star correspond r d figur show comparison convent strategi leftmost solid curv recurs strategi regard effort given n slope recurs curv get closer slope convent case snap use note convent case number snap equal n henc figur show clear advantag recurs method regard memori specif wherea increas n convent case lead increas tape usag recurs strategi enabl user consid wider rang n fix tape size dr jm restrepo g k leaf a griewank feasabl latter strategi dictat speed machin willing pay higher effort involv compar previou figur show price pay higher wallclock time smaller number snap employ may effort requir larg problem signific must weigh fact problem may simpli imposs consid convent strategi logeffortlogn convent d d figur comparison convent recurs strategi effort versu n memori requir convent case n recurs curv label accord number snap use natur logarithm use applic quasigeostroph ocean problem recurs procedur viabil demonstr appli quasigeostroph model consid tziperman thacker studi hereon refer tt dimensionless equat unitsquar box x x streamfunct vortic x y wind stress jdelta delta symbol jacobian argument delta laplacian oper dimensionless real paramet r ffl b ffl h rossbi number bottom friction factor horizont friction factor respect state variabl evolv time subject noflux nostress boundari condit edg box equat discret use multigrid finitediffer techniqu formul firstord accur time secondord accur space follow understood state variabl defin uniformli discret grid x y omit explicit mention quantiti discret space sake clariti discret time grid ideltat state variabl evolv steadi state e follow tt assimil problem defin follow observ data steadyst vortic e independ time state set taken forc term curl initi vortic paramet ffl b ffl h observ e determin particular fix choic friction factor effl b effl h initi vortic forc curl system integr forward time steadyst reach point observ record purpos artifici assimil problem forget state set valu produc observ task assimil reconstruct state set gener observ end cost function chosen measur fit model result observ sinc observ repres steadyst cost function measur departur model steadyst well departur observ tt author use follow discret cost function sum meant indic sum discret valu variabl unit box first term measur deviat observ second term conjunct first measur deviat steadyst matric c invers covari matric observ final time step n arbitrari problem chosen suffici larg steadyst achiev small valu n reduc comput cost per optim iter howev increas number optim iter sinc number record histori depend number time step n storag requir reduc n small fact tt experi choic possibl sinc assimil occur one time level gener case assimil may occur multipl time level case number time step use determin problem cannot arbitrarili chosen optim task find state set fcurl h n minimum subject constraint model equat common strategi comput minimum introduc lagrang multipli correspond lagrang function seek unconstrain extremum gradientbas iter algorithm conjug gradient method appli unconstrain problem jm restrepo g k leaf a griewank discret quasigeostroph model lagrang function form ae i t x oe descent algorithm requir calcul gradient l n respect state set gradient involv lagrang multipli f determin gradient l n respect fi g equat gradient zero gener adjoint equat f may symbol express psi forc term aris gradient cost function respect g discret adjoint equat integr backward time gener lagrang multipli use comput gradient cost function need conjug gradient procedur thu convent approach conjug gradient iter requir forward integr n step gener valu cost function follow backward integr adjoint equat adjoint integr gener gradient use conjug gradient iter note state set requir effect calcul lagrang multipli ordinarili state set time step requir calcul adjoint problem henc record forward sweep sinc state variabl timedepend particular problem need record state variabl time step remain compon state set need record forwardbackward sweep observ synthes run discret version steadyst use demonstr perform recurs forwardbackward integr strategi calcul gradient compar model run experi use tt origin multigrid fortran code version code ident respect tt code except subroutin gener schedul minor modif program enabl us carri schedul out first step thoroughli verifi program result yield ident result convent case wallclock time neglig higher recurs program run convent mode reflect addit comput expens gener schedul experi report optim toler nag conjug gradient routin set gamma model run squar sum box residu calcul forward run use creat observ step time residu gamma multigrid depth fix level experi follow code execut sparc run suno u fortran sun compil use fortran version optim memori floatsn figur comparison convent recurs strategi tt problem tape versu n recurs strategi snap held fix recurs strategi fix tape length float flag turn off run perform doubleprecis arithmet wallclock time report encompass solut full problem experi perform answer strategi ident figur show comparison tape usag convent recurs strat egi recurs trial snap count held fix explain curv tape usag vertic straight line mention previous convent case tape usag proport number time step n figur tape convent case follow experi fix amount tape particular machin convent approach would imposs suffici larg problem figur show wallclock time experi trial conjug gradient procedur converg three iter convent wallclock time second recurs version took jm restrepo g k leaf a griewank time secondsn figur comparison convent recurs strategi tt problem wallclock versu n recurs strategi snap held fix rightmost curv correspond recurs strategi longer complet growth linear tabl contain inform particular set trial anoth typic problem recurs strategi would prove use illustr follow exampl assimil problem flexibl choos integr time sinc requir must longer n minimum number step steadyst solut precis type problem investig tziperman thacker studi suppos particular resolut problem fit thu solv particular machin use convent approach order doubl spatial resolut convent strategi would requir fourfold increas tape storag doublyresolv experi longer could perform particular machin howev problem could solv use recurs approach long maximum tape length exceed tabl ratio wallclock time recurs convent approach versu n number rep tt problem suppos maximum tape length machin float actual requir singlyresolv tt problem spatial grid refin level tabl provid result sever run use recurs strategi doublyresolv problem suppos convent procedur could could carri out tape length doublyresolv problem would float would taken second execut tabl demonstr doublyresolv problem succes carri two four time amount time would take run convent procedur assum could possibl comput convent first place tabl wallclock time tape length recurs convent approach versu n tt problem doubl resolut time sec tape float snap rep conclus shown studi recurs strategi due griewank adjointmethod calcul gradient may appli largescal geophys variat data assimil studi main result significantli larger assimil studi perform use recurs strategi possibl use convent forwardadjoint method given physic limit avail comput storag hardwar expens reason addit comput effort or wallclock time furthermor procedur yield gradient degrad compar jm restrepo g k leaf a griewank convent approach theori number snap rep ie number storag unit measur r number addit unrecord forward run equal bound log n n number time step evolut equat practic strategi best use pick maximum number snap particular comput hardwar manag thu minim number rep remark element z complet cover z furthermor distanc neighbor element set get larger larger n is reader may thu wonder strategi option may viabl pick n z n greater equal requir number time step problem fix d say adjust r n slightli greater n pick finer or coarser time discret circumv storag limit far outweigh rel minor complic present fact option simplest suitabl tt problem forese recurs strategi would simplest implement problem like steadyst climat hydrolog oilrecoveri etc least straightforward problem like metereolog forecast earthquak forecast like forecast problem perhap altern partit algorithm denser set z n may consid appropri insofar comput program design best strategi largescal problem construct program computeintens possibl least memoryintens yield greatest variat comput effort given choic snap rep especi true parallel program comput effort drop greater number processor use wherea storag requir remain fix independ number processor implement recurs strategi requir minim modif convent code comput forward adjoint problem requir four modul provid name forward modul run without record state set specifi start end time step modul comput singl unrecord forward singl adjoint step given specif time step modul record tape state set current time step modul retriev tape last record state set addit modul consid driver run abovement modul accord recurs schedul driver requir input total number time step number snap number rep one approach implement schedul driver schedul comput top program schedul instruct save integ array call sequenc drive four modul benefit precomput schedul warrant applic sinc schedul modul increas insignificantli overal comput effort prefer altern use schedul driver control abovement modul thu wast regist memori schedul array need first approach could otherwis use adjoint problem estim addit memori integ schedul array first approach follow schedul array instruct direct size rn requir plu one two array similar size direct record access snap tape total regist overhead order rn integ user particular applic clearli dictat altern work best schedul driver avail via anonym ftp infomcsanlgov file call pubtech reportsrestreposcheduletarz altern schedul softwar avail either fortran c version wordwideweb softwar section httpwwwmcsanlgovpeoplerestrepoindexhtml jm restrepo g k leaf a griewank r metereolog data assimil oceanograph variat four dimension analysi use quasigeostroph con straint find steadi state gener circul model data assimil applic north atlant ocean newton method model trust region modif solut nonlinear finit differ ocean model optim method sensit observ strategi analysi role integr time determin steadi state data assimil adjoint method obtain rapidli grow perturb ocean flow fit dynam data variat assimil meteorolog observ adjoint vortic equat optim controladjoint equat approach studi ocean gener circul achiev logarithm growth tempor spatial complex revers automat differenti driven ocean circul part tr ctr andrea griewank andrea walther algorithm revolv implement checkpoint revers adjoint mode comput differenti acm transact mathemat softwar tom v n p march patrick heimbach chri hill ralf gier effici exact adjoint parallel mit gener circul model gener via automat differenti futur gener comput system v n p octob yanhua cao jiang zhu zhendong luo i m navon reducedord model upper tropic pacif ocean model use proper orthogon decomposit comput mathemat applic v n p octob matthia heinkenschloss timedomain decomposit iter method solut distribut linear quadrat optim control problem journal comput appli mathemat v n p januari