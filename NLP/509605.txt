t compil stencil high perform fortran a mani fortran hpf program perform dens matrix comput main comput portion program belong class kernel known stencil stencil comput commonli use solv partial differenti equat imag process geometr model effici handl stencil critic achiev high perform distributedmemori machin compil stencil effici code view import compani built specialpurpos compil handl other ad stencilrecogn exist compilersin paper present gener compil strategi stencil written use fortran array construct strategi capabl optim singl multistat stencil applic stencil specifi shift intrins arraysyntax equal well strategi elimin need patternrecognit algorithm orchestr set optim address overhead intraprocessor interprocessor data movement result translat fortran array construct experiment result show code produc strategi beat match best code produc specialpurpos compil patternrecognit scheme known us addit strategi produc highli optim code situat other fail produc sever order magnitud perform improv thu provid stencil compil strategi robust predecessor b introduct highperform fortran hpf extens fortran attract consider attent promis languag write portabl parallel program hpf offer simpl program model shield programm intricaci concurr program manag distribut data programm express data parallel use fortran array oper use data layout direct direct partit data comput among processor parallel machin mani program perform dens matrix comput main comput portion program belong class kernel known stencil hpf gain accept vehicl parallel scientif program must achiev high perform import class problem compil stencil effici code view import compani built specialpurpos compil handl other ad stencilrecogn exist hpf compil previou approach stencil compil signific limit restrict type stencil could handl paper focu problem optim stencil comput matter instanti programm execut distributedmemori archi tectur strategi orchestr set optim address overhead intraprocessor interprocessor data movement result translat for array construct addit optim address issu scalar array assign statement loop fusion data local next section briefli discuss stencil comput execut cost distributedmemori machin section give overview compil strategi discuss individu optim section present extend exampl show strategi handl difficult case experiment result given section section compar strategi known effort comput section introduc stencil comput give overview execut cost distributedmemori machin also introduc normal intermedi form compil use stencil stencil stencil styliz matrix comput group neighbor data element combin calcul new valu typic combin form sum product type comput common solv partial differenti equat imag process geometr model fortran array assign statement figur commonli refer point stencil statement src dst array cc either scalar array interior element result array dst comput correspond element sourc array src neighbor figur point stencil comput figur point stencil comput figur problem purdu set element src north west south east point stencil comput grid element exploit cshift intrins might specifi shown figur previou two exampl stencil specifi singl array assign statement need alway case consid point stencil abov programm attempt optim program hand stencil preprocess optim phase compil might present code shown figur goal work gener same highlyoptim code stencil computa tion regardless written hpf reason design optim target gener normal input form stencil stencillik comput translat normal form factor express introduc temporari array fact intermedi form use sever distributedmemori compil normal form sever distinguish characterist ffl cshift intrins temporari array insert perform data movement need oper array section differ processor map exampl taken problem purdu set adapt fortran benchmark thoma haupt npac figur intermedi form point stencil comput ffl cshift intrins occur singleton oper righthand side array assign statement appli whole array ffl express actual comput stencil oper operand perfectli align thu commun oper requir exampl given point stencil comput present figur cm fortran compil would translat sequenc statement shown figur rest paper assum stencil comput normal form array distribut block fashion although concentr stencil express use cshift intrins techniqu present gener handl eoshift intrins well stencil execut execut stencil comput distributedmemori machin two major compon data movement associ set cshift oper calcul sum product first phase stencil comput data movement associ cshift oper perform illustr data movement singl cshift use exampl figur show effect cshift along second dimens twodimension blockdistribut array cshift oper perform distribut array two major action take place data element must shift across process element pe boundari sent appropri neighbor pe interprocessor compon shift figur dash line repres type data movement case transfer column data neighbor processor data element shift within pe copi appropri locat destin array intraprocessor compon shift solid line figur repres data movement follow data movement second phase stencil comput execut loop nest calcul sum product loop nest stencil comput figur construct compil two step first compil appli scalar replac fortran array oper serial loop nest oper individu data element next compil transform loop nest spmd code spmd code synthes reduc loop bound pe comput valu data own copi transform loop nest known subgrid loop nest execut pe parallel machin due natur stencil make mani distinct array refer subgrid loop easili becom memori bound loop cpu must often sit idl wait array element fetch memori compil strategi section start overview compil strategi present individu compon optim given stencil comput normal form as describ section optim appli sequenc four optim first address intraprocessor data movement associ cshift oper elimin possibl second rearrang statement separ block comput oper commun oper optim stencil promot loop fusion comput oper prepar commun oper optim follow phase next interprocessor data movement cshift oper optim elimin redund partiallyredund commun final looplevel transform appli optim comput optim intraprocessor data movement intraprocessor data movement associ shift intrins complet elimin possibl accomplish optim call offset array optim determin sourc array src destin array dst cshift share memori locat case interprocessor data movement need occur exploit overlap area receiv data copi processor accomplish appropri refer destin array rewritten refer sourc array indic offset shift amount princip challeng determin sourc destin array share storag establish set criteria determin safe profit creat offset array criteria algorithm use verifi describ detail elsewher gener approach allow sourc destin array shift oper share storag destruct updat either array shift offset small constant determin destin array assign statement cshiftsrcshiftdim may offset array perform follow transform code transform take advantag data may share sourc array src destin array dst move requir data pe first replac shift oper call routin move offprocessor data src overlap area call overlap shiftsrcshiftdim replac use array dst reach definit use array src newli creat refer src carri along special annot repres valu shift dim final creat subgrid loop scalar phase alter subscript indic use offset array array subscript use offset refer src ident subscript would gener dst except dimth dimens increment shift amount algorithm devis verifi criteria perform transform base upon static singl assign ssa intermedi represent algorithm valid use offset array shift oper transform program propag inform optimist manner propag continu refer transform one criteria violat criterion violat may necessari insert array copi statement program maintain origin semant insert copi statement perform intraprocessor data movement avoid overlap shift due offset array algorithm optimist natur abl elimin intraprocessor data movement associ shift oper mani difficult situat particular determin offset array exploit even definit use separ program control flow allow stencil compil strategi elimin intraprocessor data movement situat strategi fail statement reorder follow offset array optim context partit optim optim partit set fortran statement group congruent array statement scalar express commun oper assist compil stencil follow two way first group congruent array statement togeth ensur subgrid loop gener via scalar loop fusion much comput possibl place within loop without caus loop overfus loop overfus code produc result parallel loop exhibit wors perform code separ parallel loop also structur subgrid loop produc regular characterist increas chanc loop transform perform later success exploit data reus data local second group togeth commun oper simplifi task reduc amount interprocessor data movement discuss next subsect accomplish context partit use algorithm propos kennedi c kinley algorithm develop partit parallel serial loop fusibl group use partit fortran statement congruenc class algorithm work data depend graph ddgwhich must acycl sinc appli set statement within basic block depend graph contain loopindepend depend thu acycl complet descript context partit algorithm avail elsewher along discuss advantag simd mimd machin context partit key abil optim multistat stencil fulli singlestat stencil stencil compil strategi capabl minim interprocessor data movement intraprocessor data movement elimin partit statement group congruent oper focu attent interprocessor data movement occur call cshift due natur offset array present mani opportun elimin redund partial redund data movement call optim commun union sinc combin set commun oper produc smaller set oper two key observ allow us find elimin redund interprocessor data movement first shift oper includ overlap shift commut array statement congruent oper array ident distribut cover iter space thu array shift onc order shift oper manner like without affect result second sinc overlap shift move data overlap area subgrid shift larg amount given direct dimens may subsum shift smaller amount direct dimens formal overlap shift amount dimens k redund exist overlap shift amount j dimens k jjj jij sinc alreadi appli context partit optim program restrict focu individu group call overlap shift elimin redund data movement use commun union first use commut properti rewrit shift multioffset array overlap shift lower dimens occur first use input overlap shift higher dimens reorder call overlap shift sort shift dimens lowest highest scan overlap shift lowest dimens keep largest shift amount direct other elimin redund commun union proce process overlap shift higher dimens ascend order perform follow three action scan overlap shift given dimens determin largest shift amount direct look sourc array alreadi offset array indic multioffset array these use annot associ sourc array creat rsd use option fourth argument call overlap shift argument indic data element adjac overlap area also move shift oper map annot rsd simpli matter ad annot correspond rsd dimens annot ad lower bound rsd shift amount neg otherwis ad upper bound shift amount larger rsd subsum smaller rsd gener singl overlap shift direct use largest shift amount includ rsd need overlap shift dimens elimin procedur elimin redund offsetshift commun includ partial redund data movement associ access corner element stencil algorithm uniqu base upon understand analysi shift intrins rather base upon patternmatch done mani stencil compil optim elimin commun shift array except singl messag direct dimens number messag stencil thu minim exampl consid point stencil comput present figur origin stencil specif requir twelv cshift intrins appli commun union four call overlap shift shown figur requir figur display data movement result call figur contain theta subgrid solid line surround overlap area dash line portion figur commun union point stencil figur first half point stencil com munic figur result commun oper adjac subgrid also shown figur depict data movement specifi first two call result data movement shown figur overlap area properli fill in data movement last two call shown figur notic last two call pick data overlap area fill first two call thu popul overlap area element need subsequ comput shown figur figur second half point stencil commun figur result commun oper optim comput final scalar produc subgrid loop nest optim appli set looplevel transform design improv perform memorybound program transform includ unrollandjam address memori refer enc loop permut address cach refer optim program exploit reus data valu optim describ detail elsewher address paper extend exampl section trace compil strategi extend exampl detail examin show strategi abl produc code match beat handoptim code also demonstr abl handl stencil comput caus method fail exercis chosen use problem purdu set adapt fortran benchmark thoma haupt npac program kernel shown figur array t u rip rin twodimension distribut blockblock fashion kernel comput standard point stencil ident comput singlestat stencil shown figur reason written fashion reduc memori requir given singlestat point stencil fortran compil gener temporari array one cshift greatli restrict size problem solv given machin contrast problem specif comput temporari array sinc liverang last cshift overlap reduc temporari storag requir factor four addit assign cshift rip rin perform common subexpress elimin remov four duplic cshift origin specif stencil figur show comparison execut time singlestat cshift stencil figur multistat problem stencil figur program compil ibm xlhpf compil execut processor sp vari problem size seen singlestat stencil specif exhaust avail memori larger problem size even though pe mbyte real ram program normal step compil stencil code figur use strategi present paper figur show stencil code normal six cshift subexpress assign statement array hoist statement assign compilergener temporari array sinc live rang temporari array overlap singl temporari share among statement altern cshift could receiv temporari array would affect result stencil compil strategi execut time ms subgrid size squar exceed memori cshift specif purdu problem figur comparison two point stencil specif figur problem normal offset array optim shift oper identifi hoist assign state ment appli offset array optim exampl algorithm determin shift array made offset array seen figur cshift oper chang overlap shift oper refer assign array replac offset refer sourc array u intraprocessor data movement thu elimin addit notic temporari array compilergener tmp array figur problem offset array optim figur problem context partit optim userdefin rip rin longer need comput stencil use array routin need alloc reduct storag requir allow larger problem solv given machin context partit optim offset array optim appli context partit algorithm algorithm begin determin congruenc class present section code exampl two congruenc class array statement congruent commun statement depend graph comput next two type depend exist code true depend overlap shift oper express use offset array true antidepend exist multipl occurr array t sinc figur problem commun union optim depend two class statement commun class statement congruent array class context partit algorithm abl partit statement perfectli two group result shown figur sinc array statement adjac scalar abl fuse singl loop nest similarli commun statement adjac commun union success task commun union optim turn attent interprocessor data movement specifi overlap shift oper describ section first exploit commut overlap shift oper rewrit multidimension overlap shift lower dimens shift first rewrit necessari exampl sinc dimens shift occur first seen figur next look shift across first dimens sinc singl shift distanc one direct redund commun elimin second dimens find shift distanc one howev discov four multioffset array examin annot offset array creat rsd summar overlap area necessari gener two call overlap shift includ rsd elimin overlap shift call second dimens result code shown figur commun union reduc amount commun minimum singl commun oper dimens direct scalar memori optim figur show code scalar code contain interprocessor commun oper intraproceesor data movement perform final transform refin loop bound gener node program access subgrid local pe strategi gener singl loop nest which due natur stencil comput ripe opportun memori hierarchi optim hand final code optim node compil perform looplevel transform scalar replac unrollandjam enddo enddo figur problem scalar import note strategi also produc exact code given singlestat point stencil figur exampl show stencil compil algorithm capabl fulli optim stencil matter instanti programm experiment result measur perform boost suppli step stencil compil strategi ran set test processor ibm sp start gener naiv translat problem test case fortranmpi consid origin version success appli transform outlin preced section measur execut time result shown figur analyz result figur worthwhil compar result shown figur problem code perform origin mpi version code exampl alreadi order magnitud faster code produc ibm xlhpf compil second versu second largest problem size appli offset array optim fortranmpi test case shown figur execut time improv equival speedup next appli context partit shown figur scalar abl merg comput singl loop nest improv execut time addit point reduc execut time origin program speedup shown figur commun union optim elimin four commun oper reduc execut time compar contextoptim version appli memori optim scalar replac unrollandjam reduc execut time anoth execut time origin program trim equival speedup compar code code produc ibm xlhpf compil show speedup factor lest someon think chosen ibm xlhpf compil straw man collect addit perform number gener third version point execut time ms subgrid size squar origin program offset array context partit commun union memori optim figur stepwis result stencil compil strategi problem execut sp stencil comput one use array syntax similar point stencil shown figur point stencil comput comput interior element matrix is element n dimens graph compar execut time two point stencil specif given figur ibm xlhpf compil use case interest note array syntax stencil xlhpf compil produc perform number track best perform number problem size except largest advantag import note stencil compil strategi present handl three specif point stencil equal well algorithm base upon analysi optim base construct upon stencil built algorithm design handl lowest common denomin form compil transform stencil comput relat work one first major effort specif address compil stencil comput distributedmemori machin stencil compil cm also known convolut compil compil elimin intraprocessor data movement optim interprocessor data movement exploit cm polyshift commun final comput perform handoptim librari microcod took advantag sever loop transform special regist alloc scheme gener compil methodolog produc style code special compil elimin intraprocessor data movement minim interprocessor execut time ms subgrid size squar exceed memori cshift specif purdu problem array syntax figur comparison three point stencil specif data movement final use looplevel optim perform unrollandjam optim accomplish data reus stencil compil multistencil swath cm stencil compil mani limit howev could handl singl statement stencil stencil specifi use cshift intrins arraysyntax stencil would accept sinc compil reli upon pattern match stencil specif form sum term coeffici multipli shift express variat possibl final programm recogn stencil comput extract program place subroutin compil stencil compil compil scheme handl strict superset pattern handl cm stencil compil word avoid gener problem restrict domain applic place restrict upon work strategi optim singlestat stencil multistat stencil cshift intrins stencil arraysyntax stencil equal well sinc optim design incorpor hpf compil benefit comput slightli resembl stencil also commerci avail compil handl certain styl ize singlestat stencil maspar fortran compil avoid intraprocessor data movement singlestat stencil written use array notat accomplish scalar fortran express avoid gener cshift use depend analysi find loopcarri depend indic interprocessor data movement interprocessor data move local copi requir how ever compil still perform data movement singlestat stencil written use shift intrins strategi share mani fortranhpf compil focu handl scalar code cm stencil compil methodolog strict superset strategi gupta et al describ ibm xlhpf compil state abl reduc number messag multidimension shift exploit method similar our howev describ algorithm accomplish thi unknown whether would abl elimin redund commun aris shift dimens direct differ distanc portland group pghpf compil describ bozku et al perform stencil recognit optim comput use overlap shift commun also perform subset commun union optim howev limit singlestat express case gener sever differ method handl specif form stencil comput strategi handl gener form stencil comput earlier method conclus paper present gener compil scheme compil hpf stencil comput distributedmemori architectur strategi optim comput orchestr uniqu set optim optim elimin unnecessari intraprocessor data movement result cshift intrins rearrang array statement promot profit loopfus elimin redund interprocessor data movement optim memori access via looplevel transform optim gener enough includ generalpurpos hpffortran compil benefit mani comput fit stencil pattern strength optim oper normal form stencil comput readili translat enabl us optim stencil comput regardless whether written use array syntax explicit shift in trinsic whether stencil comput singl statement multipl statement approach significantli gener stencil compil approach previou compil even though focus compil stencil distributedmemori machin paper techniqu present equal applic optim stencil comput sharedmemori scalar machin with except reduc interprocessor movement acknowledg work support part ibm corpor center research parallel comput an nsf scienc technolog center darpa contract dabtc work also support part defens advanc research project agenc rome laboratori air forc materiel command usaf agreement number f us govern author reproduc distribut reprint government purpos notwithstand copyright annot thereon view conclus contain herein author interpret repres offici polici endors either express impli defens advanc research project agenc rome laboratori us govern r techniqu compil execut hpf program sharedmemori distributedmemori parallel system compil data parallel program messag pass program massiv parallel mimd system stencil compil connect machin model cm stencil compil connect machin model cm compil fortran mimd distributedmemori machin effici comput static singl assign form control depend graph commun softwar connect machin system cm cm updat distribut variabl local comput hpf compil ibm sp low level hpf compil benchmark suit high perform fortran forum optim fortran shift oper distributedmemori multicomput context optim simd execut optim techniqu simd fortran compil improv data local loop transfor mation applic benchmark set fortrand high perform for tran problem test parallel vector languag optim fortrandhpf distributedmemori comput compil massiv parallel distribut memori mimd comput optim supercompil supercomput tr updat distribut variabl local comput fortran ten gigaflop effici comput static singl assign form control depend graph compil optim improv data local polyshift commun softwar connect machin system cm hpf compil ibm sp improv data local loop transform pghpfmyampersandmdashan optim high perform fortran compil distribut memori machin optim fortrandhpf distributedmemori comput optim supercompil supercomput optim fortran shift oper distributedmemori multicomput ctr david wonnacott achiev scalabl local time skew intern journal parallel program v n p june m kandemir data local definit abstract applic proceed ieeeacm intern confer computeraid design p novemb san jose ca hitoshi sakagami hitoshi murai yoshiki seo mitsuo yokokawa tflop threedimension fluid simul fusion scienc hpf earth simul proceed acmiee confer supercomput p novemb baltimor maryland g chen m kandemir optim interprocessor data local embed chip multiprocessor proceed th acm intern confer embed softwar septemb jersey citi nj usa armando solarlezama gilad arnold liviu tancau rastislav bodik vijay saraswat sanjit seshia sketch stencil acm sigplan notic v n june steven j deitz bradford l chamberlain lawrenc snyder elimin redund sumofproduct array comput proceed th intern confer supercomput p june sorrento itali gerald roth ken kennedi loop fusion high perform fortran proceed th intern confer supercomput p juli melbourn australia a ya kalinov a l lastovetski i n ledovskikh m a posypkin compil vector statement c languag architectur multilevel memori hierarchi program comput softwar v n p mayjun mari jane irwin compilerdirect proactiv power manag network proceed intern confer compil architectur synthesi embed system septemb san francisco california usa zhang zhengqian kuang baim feng jichang kang autocfdnow precompil effect parallel cfd applic network workstat journal supercomput v n p novemb daniel j rosenkrantz lenor r mullin harri b hunt iii minim materi arrayvalu temporari acm transact program languag system topla v n p novemb