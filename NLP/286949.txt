t safe metaclass program a system class treat first class object class defin instanc class call metaclass import benefit use metaclass abil assign properti class eg abstract final trace particular messag support multipl inherit independ baselevel code howev inherit instanti explicitli simultan involv commun class instanc rais metaclass compat issu languag such smalltalk address issu easili allow assign specif properti class contrast languag such clo allow assign specif properti class tackl compat issu wellin paper describ new model metalevel organ call compat model overcom difficulti allow safe metaclass program sinc make possibl assign specif properti class ensur metaclass compat therefor take advantag express power metaclass build reliabl softwar extend compat model order enabl safe reus composit class specif properti extens implement neoclasstalk fulli reflect smalltalk b introduct shown program metaclass great benefit kaj interest use metaclass assign specif properti class exampl class abstract uniqu instanc trace messag receiv instanc defin prepost condit method forbid redefinit particular method properti implement use metaclass allow therebi custom class behavior lc architectur point view use metaclass organ applic abstract level level describ control level immedi causal connect mae reifi class commun object includ instanc thu class send messag instanc instanc send messag class messag send name interlevel commun mmc howev careless inherit one level may break interlevel commun result issu call compat issu bslr identifi two symmetr kind compat issu first one upward compat issu name metaclass compat nicola graub gra second one downward compat issu kind compat issu import impedi metaclass program one alway awar of current none exist languag deal metaclass allow assign specif properti class ensur compat clo kdrb allow one assign properti class ensur compat hand som som smalltalk gr address compat issu introduc class properti propag problem inde properti assign class automat propag subclass therefor som small talk class cannot specif properti exampl assign abstract properti given smalltalk class subclass becom abstract bc follow user face dilemma use languag allow assign specif class properti without ensur compat use languag ensur compat suffer class properti propag problem paper present model compat model allow safe metaclass program ming ie make possibl assign specif properti class without compromis compat addit ensur compat compat model avoid class properti propag class assign specif properti without sideeffect subclass implement compat model neoclasstalk smalltalk extens introduc mani featur includ explicit metaclass riv experi ledriv show compat model allow programm fulli take advantag express power metaclass effort result i tool permit programm unfamiliar metaclass transpar deal class specif properti ii approach allow reus composit class properti paper organ follow section present compat issu give exampl show signific section show exist program languag address compat issu deal properti propag problem section describ solut illustr exampl section deal reus composit class specif properti within compat model then sketch use compat model baselevel metalevel programm last section contain conclud summari interlevel commun compat defin interlevel commun messag send class instanc see figur inde class object interact object send receiv messag particular instanc send messag class class send messag instanc use smalltalk exampl illustr issu messag send class level instanc level figur interlevel commun two method allow interlevel commun smalltalk new class one use involv object belong differ level abstract ffl object receiv class messag return class then class method make possibl go one level up follow two instanc method excerpt visual work smalltalk includ messag send receiv class messag name sent class objectaeprinton astream titl self class name messag daysinyear sent class dateaedaysinyear answer number day year repres receiv self class daysinyear self year ffl class receiv new messag return new instanc therefor new method make possibl go one level down follow two class method includ messag send newli creat instanc messag atput sent new instanc arrayedcollect anobject newcollect j newcollect self new newcollect at put anobject newcollect messag on sent new instanc browser classaeopenon anorgan self openon self new on anorgan with textstat nil thu interlevel commun smalltalk materi send messag new class languag class reifi such clo som also allow similar messag send sinc interlevel commun messag embed method inherit whenev method inherit ensur compat mean make sure method induc failur subclass ie sent messag alway understood identifi two kind compat upward compat downward compat use smalltalk syntax terminolog throughout paper measur made visual work smalltalk imag show interlevel commun frequent class includ instanc method referenc class metaclass defin method referenc instanc nicola graub name issu metaclass compat gra ifoo cbar inherit instanti self class cbar figur compat need ensur higher level upward compat suppos implement method ifoo send cbar messag class receiv see figur b subclass a ifoo sent instanc b b class receiv cbar messag order avoid failur b understand cbar messag ie metab implement inherit method cbar definit upward compat let b subclass class a metab metaclass b metaa metaclass a upward compat ensur metab metaa iff everi possibl messag lead error instanc a lead error instanc b downward compat suppos implement method cfoo send ibar messag newli creat instanc see figur metab creat subclass metaa cfoo sent b an instanc metab b creat instanc receiv ibar messag order avoid failur instanc b understand ibar messag ie b implement inherit ibar method ibar cfoo inherit instanti self new ibar figur compat need ensur lower level definit downward compat let metab subclass metaclass metaa downward compat ensur two class b instanc metab instanc everi possibl messag lead error a lead error b exist model show none known model allow assign specif properti class ensur compat redefin class clo validatesuperclass gener function call direct store kdrb default validatesuperclass return true metaclass new class metaclass superclass ie class subclass must metaclass therefor incompat avoid metaclass program constrain inherit instanti b figur default clo subclass must share metaclass superclass figur show hierarchi two class illustr clo default compat manag polici sinc class b inherit a b must metaclass order allow definit class differ behavior programm usual redefin validatesuperclass method make alway return true thu clo programm total freedom use specif metaclass class so assign specif properti class tradeoff need alway awar compat issu som som ibm corba compliant product base metaclass architectur dfb som kernel follow objvlisp model coi som metaclass explicit mani instanc therefor user complet freedom organ metaclass hierarchi compat issu som som encourag definit use explicit metaclass introduc uniqu concept name deriv metaclass deal upward compat issu dfa compiletim som automat determin appropri metaclass ensur upward compat need som automat creat new metaclass name deriv metaclass ensur upward compat instanti inherit self class cbar aifoo class parent a metaclass metab deriv cbar ifoo figur som ensur upward compat use deriv metaclass fact also return true superclass class name t metaclass one argument standardclass metaclass funcallablestandardclass suppos want creat class b instanc metab subclass a som detect upward compat problem sinc metab inherit metaclass metaa therefor automat creat deriv metaclass deriv use multipl inherit order support necessari class method variabl figur show result construct instanc b receiv ifoo goe one level higher send cbar b class b understand cbar messag sinc metaclass ie deriv deriv metaclass inherit metab metaa inherit instanti self new ibar somobject ibar cfoo somclass figur exampl som provid polici mechan handl downward compat suppos metab creat subclass metaa see figur cfoo method inherit metab send ibar messag new instanc b class receiv cfoo messag runtim error occur instanc understand ibar messag class properti propag som som allow assign properti given class without make subclass assign properti name defect class properti propag problem follow exampl illustr deriv metaclass implicitli caus undesir propag class properti inherit instanti class parent a metaclass soleinst deriv soleinst releas figur class properti propag som suppos class figur releas class ie modifi more properti use multiprogramm develop environ version purpos order avoid chang instanc releas metaclass let b class uniqu instanc b instanc soleinst metaclass b subclass a som creat b instanc automat creat deriv metaclass inherit soleinst releas thu soon b creat automat lock act like releas class so cannot defin new method it semant deriv metaclass guarante declar metaclass take preced resolut multipl inherit ambigu ie metab metaa besid ensur instanc variabl class correctli initi use complex mechan smalltalk smalltalk metaclass partial hidden automat creat system metaclass nonshar strongli coupl sole instanc so metaclass hierarchi parallel class hierarchi implicitli gener class creat compat issu smalltalk use parallel inherit hierarchi smalltalk model ensur upward downward com patibl inde code deal new class method inherit work properli instanti inherit class cbar cfoo ifoo classcfoo self new ibar self class cbar aifoo class ibar figur smalltalk ensur upward downward compat one creat b class subclass see figur smalltalk automat gener metaclass b b class subclass a class metaclass a suppos implement method ifoo send cbar class receiv ifoo sent instanc b b class receiv cbar messag thank parallel hierarchi b class understand cbar messag upward compat ensur similar manner downward compat ensur thank parallel hierarchi class properti propag smalltalk sinc metaclass automat implicitli manag system smalltalk drastic reduc opportun chang class behavior make metaclass program anecdot som smalltalk allow assign properti class without propag subclass inherit class class classnew self error i abstract instanti figur class properti propag smalltalk figur class abstract sinc subclass must implement method complet instanc behavior b concret class implement whole set method suppos want enforc properti abstract a order forbid instanti a defin class method classaenew rais error unfortun b class inherit method new a class result attempt creat instanc b rais error name smalltalk metaclass name uniqu instanc postfix word class exampl deliber simpl one could avoid problem redefin new b class but solut compat model among previou model smalltalk one parallel hierarchi ensur full compati biliti howev allow assign specif properti class hand clo model allow assign specif properti class unfortun ensur compat believ two goal achiev new model make clear separ compat class specif properti inherit instanti abstract classnew self error i abstract class class abstract class figur avoid propag abstract illustr idea separ concern refactor exampl figur creat new metaclass name abstract class subclass a class see figur class redefin instanc new metaclass abstract class redefin new method rais error cannot instanc howev sinc b class subclass abstract b class remain concret gener scheme solut name compat model remaind paper name metaclass defin class properti denot concaten properti name symbol superclass name exampl abstract class subclass a class defin properti abstract name abstract descript compat model compat model extend smalltalk model separ two concern compat specif class properti metaclass hierarchi parallel class hierarchi ensur upward downward compat like smalltalk extra metaclass layer introduc order local assign properti class class instanc metaclass belong layer so compat model base two layer metaclass one address uniqu concern compat concern issu address metaclass organ hierarchi parallel class hierarchi name metaclass compat metaclass defin behavior must propag subclass class method send messag instanc defin metaclass besid messag sent class instanc defin metaclass too specif class properti concern issu address metaclass defin class specif properti name metaclass properti metaclass class specif properti instanc properti metaclass inherit correspond compat metaclass properti metaclass join properti metaclass sinc defin properti specif class kind inherit anomali my increas mainten cost aclass bclass metaclass compat metaclass properti ifoo ibar aifoo self new ibar aclasscfoo self class cbar inherit instanti cfoo bproperti cbar aproperti bclass figur compat model figur show compat model appli hierarchi consist two class b respect instanc aproperti metaclass aproperti properti specif class a bproperti properti specif class b aproperti aclass bproperti bclass join link class properti propag occur thu b distinct properti subclass aclass bclass meta class upward downward compat guarante suppos defin two instanc method ifoo ibar ifoo method send cbar messag class receiv ibar method sent new instanc cfoo method aclass bclass metaclass hierarchi parallel b class hierarchi interlevel commun failur avoid exampl refactor smalltalk boolean hierarchi boolean hierarchi smalltalk depict figur boolean abstract class defin protocol share true fals true fals concret class cannot one instanc properti ie abstract sole instanc implicit smalltalk use compat model refactor boolean hierarchi emphas them instanti inherit boolean class fals class boolean true class true fals figur boolean hierarchi smalltalk first creat boolean class compat metaclass second step consist creat properti metaclass abstract boolean class enforc boolean class abstract final build boolean class instanti abstract metaclass refactor fals class first creat fals class metaclass subclass boolean class ensur compat second step consist creat properti metaclass soleinst compat metaclass surround dash line properti metaclass drawn insid grey shape prefer academ exampl emphas idea rather complex exampl requir detail present fals class enforc fals class one instanc last creat fals class instanti soleinst fals class metaclass true class refactor way result rebuild whole hierarchi boolean shown figur abstract boolean class soleinst fals class instanti inherit fals class boolean boolean class fals true class soleinst class true figur boolean hierarchi refactor reus composit within compat model experi compat model neoclasstalk riv fulli reflect smalltalk quickli face need class properti reus composit inde unrel class belong differ hierarchi properti given class mani properti previou section true class fals class properti uniqu instanc besid assign one properti class boolean hierarchi but class need assign mani properti exampl fals class must uniqu instanc also subclass such class final java terminolog so reus compos class properti respect compat model section propos extens compat model deal reus composit class properti languag class treat regular object may integr extend compat model neoclasstalk use first experiment platform reus class properti smalltalk sinc metaclass behav differ way class defin instanc particular class metametaclass call metaclass metaclass defin behavior metaclass smalltalk exampl name metaclass name sole instanc postfix word class metaclassaenam thisclass name class take advantag concept metametaclass reus class properti sinc metaclass implement differ properti differ behavior need one metametaclass class properti properti metaclass defin class properti instanc metametaclass properti metaclass creat metametaclass initi definit correspond class properti thu code instanc variabl method correspond definit neoclasstalk relat paper download httpwwwemnfrcsobjecttoolsneoclasstalkneoclasstalkhtml class properti automat gener reus achiev creat properti metaclass defin class properti instanc metametaclass ie initi class properti definit an exampl initi given section root metametaclass hierarchi name propertymetaclass describ default structur behavior properti metaclass exampl name properti metaclass built properti name superclass name propertymetaclassaenam self class name self superclass name refactor boolean hierarchi section soleinst fals class soleinst true class defin properti uniqu instanc reus achiev defin soleinst fals class soleinst true class instanc soleinst subclass propertymetaclass see figur soleinst fals class abstract boolean class metaclass level class level metametaclass level fals class boolean instanti inherit boolean class fals true class soleinst class abstract soleinst true propertymetaclass figur reus properti boolean hierarchi composit class properti sinc given class mani properti model must support composit class proper tie chose use mani properti metaclass organ singl inherit hierarchi metaclass implement one specif class properti illustr idea modifi instanti link fals class see figur defin two properti metaclass one properti first properti metaclass soleinst inherit compat metaclass fals class second one final fals class class fals defin subclass soleinst fals class result scheme respect compat model allow assign two specif properti fals class still ensur compat conflict manag solut properti metaclass composit issu trivial inde necessari deal conflict aris compos differ properti metaclass use inherit compos properti metaclass two kind conflict aris name conflict valu conflict dhh soleinst fals class boolean class abstract boolean class fals class soleinst fals class final fals boolean instanti inherit figur assign two properti fals name conflict happen orthogon properti metaclass defin instanc variabl method name two properti metaclass orthogon defin unrel class properti name conflict instanc variabl method avoid adapt definit new properti metaclass accord superclass exampl although two properti metaclass soleinst fals class soleinst true class defin properti respect instanc class fals true may use differ instanc variabl name method name valu conflict happen nonorthogon properti metaclass defin method name conflict avoid make properti metaclass hierarchi act cooper chain ie properti metaclass explicitli refer overridden method defin superclass therefor properti metaclass act like mixin bc exampl cooper properti metaclass suppos want assign two specif properti fals class figur i trace messag trace ii breakpoint particular method breakpoint two properti deal messag handl base neoclasstalk techniqu method wrapper describ duc bfjr executemethodreceiverargu method entri point handl messag neoclasstalk ie custom executemethodreceiverargu allow special messag send thu object fals receiv messag class fals receiv messag executemethodreceiverargu accord inherit hierarchi trace first done use super breakpoint perform regular method applic final execut again call use super ffl standardclassaeexecutemethod method receiv rec argument arg ffl breakpointfals classaeexecutemethod method receiv rec argument arg method selector stopselector iftru self halt breakpoint stopselector super executemethod method receiv rec argument arg ffl tracebreakpointfals classaeexecutemethod neoclasstalk smalltalk achiev use pseudovari super executemethodreceiverargu method provid standardclass the root metaclass neo appli method receiv argument fals class instanti inherit fals trace breakpoint breakpoint fals class trace breakpoint fals class propertymetaclass metaclass level class level metametaclass level figur composit nonorthogon properti method receiv rec argument arg self transcript show method selector cr super executemethod method receiv rec argument arg extend compat model gener previou exampl allow us defin extend compat model see figur enabl reus compos class properti properti metaclass defin instanc variabl method involv uniqu properti properti metaclass specif given class organ singl hierarchi root hierarchi subclass compat metaclass properti metaclass instanc metametaclass describ specif class properti allow reus metaclass properti bclass aclass metaclass compat bclass aclass bclass bclass aclass aclass propertymetaclass figur extend compat model singl hierarchi may compar explicit linear properti metaclass compos use multipl inherit dhhm metaclass creation composit delet manag automat respect extend compat model time new class creat new compat metaclass automat creat done way smalltalk build parallel metaclass hierarchi assign properti class result insert new metaclass properti metaclass hierarchi insert made two step first new properti metaclass becom subclass last metaclass properti metaclass then class becom instanc new properti metaclass neoclasstalk provid protocol dynam chang class object changeclass superclass class superclass riv thu implement two step immedi neoclasstalk provid composewithpropertiesof method aclass self superclass aclass class aclass changeclass self program within extend compat model distinguish two kind programm i base level programm implement applic use languag develop tool ii meta level programm languag applic base level program make model easi use baselevel programm neoclasstalk program environ includ tool allow one assign differ properti given class use smalltalklik browser see figur properti ad remov runtim metaclass level automat built accord select baselevel programm meta level program order introduc new class properti metalevel programm must creat subclass prop ertymetaclass metametaclass new metametaclass store instanc variabl method defin instanc properti metaclass new metametaclass instan tiat previou instanc variabl ad result properti metaclass method compil initi time exampl evalu follow express creat properti metaclass instanc metametaclass trace assign trace properti true class trace new composewithpropertiesof true remov properti metaclass done symmetr way solut consist compil onc result protomethod riv thu properti metaclass get initi protomethod copi method dictionari properti metaclass allow fast instanti metametaclass assum initi part creation process true almost everi languag tradit nalli achiev smalltalk redefinit new super new initi skt figur properti assign class use browser order achiev trace messag must captur log text collector therefor properti metaclass instanc trace must defin instanc variabl name transcript correspond text collector method handl messag messag handl achiev use executemethodreceiverargu method sourc code alreadi present definit gener properti metaclass initi ie use initi method trace metametaclass traceaeiniti super initi self instancevariablenam transcript self generateexecutemethodreceiverargu conclus consid class first class object organ applic differ abstract level inevit rais upward downward compat issu exist solut address compat issu such smalltalk allow assign specif properti given class without propag subclass compat model propos paper address compat issu allow assign specif properti class without propag subclass achiev thank separ two involv concern compat class properti upward downward compat ensur use compat metaclass hierarchi parallel class hierar chi properti metaclass allow assign specif properti class subclass compat metaclass therefor take advantag express power metaclass defin reus compos class properti environ support safe metaclass program class properti improv readabl reusabl qualiti code increas separ concern allow better organ class librari framework design reliabl softwar strongli convinc compat model enabl separ concern base metaclass paradigm therefor promot build reliabl softwar easi reus maintain acknowledg author grate mathia braux pierr coint stephan ducass nick edgar philipp mulet jacqu noy nicola revault mario sudholt valuabl comment suggest special thank anonym refere provid detail thoughtprovok comment r program explicit metaclass smalltalk wrapper rescu concurr distribut object orient program nouri bouraqadisaadani first class objvlisp model deriv metaclass som reflect metaclass program som le point sur lheritag multipl propos monoton multipl inherit linear evalu messag pass control techniqu smalltalk metaclass compat separ concern objectori program clo perspect art metaobject protocol explicit metaclass tool improv design class librari reflect distribut system adapt objectori softwar demet method propag pattern concept experi comput reflect toward methodolog explicit composit metaobject research direct concurr objectori program new smalltalk kernel allow explicit implicit metalclass pro gram object behavior evolut within class base reflect languag smalltalk style advanc objectori metalevel architectur reflec tion tr smalltalk languag implement concept experi comput reflect first class objvlisp model metaclass compat program explicit metaclass smalltalk mixinbas inherit art metaobject protocol metaobject protocol analysi inherit anomali objectori concurr program languag propos monoton multipl inherit linear reflect metaclass program som smalltalk style toward methodolog explicit composit metaobject concurr distribut objectori program advanc objectori metalevel architectur reflect adapt objectori softwar wrapper rescu explicit metaclass tool improv design class librari ctr stphane ducass oscar nierstrasz nathanael schrli roel wuyt andrew p black trait mechan finegrain reus acm transact program languag system topla v n p march