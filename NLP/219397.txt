t adapt pattern match a pattern match import oper use mani applic function program rewrit rulebas expert system preprocess pattern dfalik automaton rapidli select match pattern singl scan relev portion input term automaton typic base lefttoright travers pattern adapt travers order suit set input pattern possibl consider reduc space match time requir automaton design adapt automata focu paper first formal notion adapt travers present sever strategi synthes adapt travers order aim reduc space match time complex worst case howev space requir exponenti size pattern show establish exponenti lower bound space independ travers order use discuss orthogon approach space minim base direct construct optim dag automata final work bring forth impact type pattern match particular show sever import problem eg lazi pattern match ml comput hard presenc type disciplin wherea solv effici untyp set b introduct pattern match fundament oper number import applic function equat program term rewrit theorem prove applica tion pattern partial order assign prioriti instanc languag ml haskel pattern occur earlier text higher prioriti follow it applic impos prioriti also handl special case match prioriti typic approach pattern match preprocess pattern dfalik automaton rapidli select pattern match input term main advantag match automaton pattern match identifi singl scan ie backtrack portion input term relev match purpos done time independ number pattern fig show match automaton construct basi lefttoright travers pattern automaton repres tabl compil case statement state automaton correspond prefix input term seen reach state annot set pattern possibl match instanc state correspond inspect prefix fb a x x denot subterm yet examin state annot pattern set f g sinc cannot rule match three pattern basi prefix fb a x research partial support nsf grant ccr ny st grant rdg research complet suni stoni brook match root input term identifi nonlinear consid sinc even applic allow pattern failur associ symbol mismatch observ gammapsi r gammapsi gammapsi r fg fg fg fg f gammapsi r r gammapsi fg figur lefttoright left adapt automata right fx a b fb a a fx a y textual order prioriti x denot variabl pattern match automata extens studi well decad augustsson wadler describ pattern match techniqu base lefttoright travers drawback method may reexamin symbol potenti sever time worst case may end test pattern separ input term drawback overcom method christian graf schnoebelen base lefttoright travers variant thereof howev space requir becom exponenti size pattern one way improv space match time engin travers order suit set pattern applic domain refer travers adapt travers automata base travers adapt automata travers order longer fix apriori adapt automaton must specifi travers order instanc adapt automaton shown fig state label next argument posit inspect state adapt travers two main advantag fixedord travers leftto right ffl result automaton smaller eg adapt automaton fig state compar lefttoright automaton reduct factor even becom exponenti ffl pattern match requir lesser time adapt travers fixedord travers furthermor fixedord travers cannot use prioriti inform avoid inspect symbol irrelev determin highest prioriti match instanc adapt automaton announc match pattern examin last two argument f wherea lefttoright automaton need inspect three argument observ examin unnecessari run counter goal lazi evalu context function program design adapt automata focu paper process studi sever import problem remain open even context automata base fixedord travers problem includ lower upper bound space complex construct optim dag automata impact type pattern match summari result first formal concept adapt travers special case name fix travers order present algorithm construct adapt automata ffl section examin space match time complex show space requir automata quit larg establish first known tight exponenti lower bound size result quit difficult obtain sinc proof must independ travers order ffl section present sever techniqu synthes travers order improv space match time first develop import concept repres set form basi sever optim techniqu aim avoid inspect unnecessari symbol present quadratictim algorithm comput repres set untyp system wherea show comput set np complet type system ffl present sever power strategi synthes travers order intric exampl show sometim increas space match time therefor present anoth strategi base select indic overcom drawback huet levi establish import index design optim automata stronglysequenti pattern result extend applic indic even pattern stronglysequenti ffl section synthes travers st given travers such lefttoright inspect index posit whenev possibl use st place affect termin properti function program programm continu assum wherea implement benefit signific improv space time use ffl section describ orthogon approach space minim base dag represen tation tightli character equival state directli build optim dag automaton import problem remain open even lefttoright travers ffl section focu import problem index comput priorit system lavil puel suarez extend huetlevi index comput algorithm deal prioriti howev algorithm requir exponenti time worst case contrast present first polynomialtim algorithm index comput untyp system furthermor also show problem conp complet type system therefor present power heurist significantli speed process type system ffl work clearli bring forth impact type pattern match shown sever import problem context pattern match unlik effici algorithm type system wherea given polynomi time algorithm untyp system clearli demonstr type make algorithm inher complex rather serv optim aid prune search space index comput suggest final implic result discuss section proof detail omit main paper found appendix preliminari section introduc notat use rest paper also present gener algorithm adapt automata construct form basi result present later section assum familiar basic concept term use roott denot symbol appear root term t notion posit use refer subterm term follow posit either empti string reach root pi p posit integ reach ith argument root subterm reach p use tp refer subterm reach p tp s denot term obtain replac subterm tp s substitut map variabl term instanc tfi term obtain substitut fix everi variabl x t instanc u say u call u prefix t fring u set variabl posit u use x z denot variabl denot unnam variabl a b c d f denot nonvari say two term unifi iff possess common instanc denot least instanc order given topdown travers inspect node term success character select function that inspect prefix u choos next posit visit match set l u prefix u set pattern unifi u let p denot set fring posit u wherein least one pattern l u nonvari adapt fix travers adapt travers topdown travers wherein posit next visit function prefix u given set pattern l fix travers order p simpli function p pattern say pattern l l match iff l l l prioriti higher l l l say pattern match t among pattern equal prioriti may announc match term instanc one pattern ambigu unambigu system set pattern l said ambigu whenev one pattern match given term otherwis l unambigu type system type system set allow input term constrain type disciplin instanc constraint may take form argument function f must drawn set ft fg case term ft allow untyp system untyp system type disciplin henc allow input term includ term alphabet sigma superset alphabet sigma use pattern pattern match tp nonvari intuit index posit must examin determin pattern match eg fring posit u everi pattern l u nonvari index gener algorithm build adapt automata state v automaton rememb prefix u inspect reach v start state suppos p next posit inspect v v transit symbol c present p l l u also transit v taken see symbol differ edg gener algorithm construct adapt automaton given below observ prioriti implicitli handl definit match procedur buildv u let denot pattern match u oe matchsetv m state v announc match pattern els select function choos next posit inspect posit inspect record po field symbol l l u nonvari c creat new node v c edg v v c label c l l u variabl p ancestor p creat new node v edg v v label buildv build similar previous known algorithm christian huetlevi main differ build gener wherea other prespecifi select function build invok call build start state automaton take two paramet v specifi state automaton u specifi prefix examin reach jm r j omega omega ae gammapsi phi c c cb l l e e e i l l l l figur adapt automaton construct build pattern shown topright prioriti bottomright po field l u shown state state label denot ident subtre state v invoc build construct subautomaton root v line creat transit base symbol could appear p pattern l u line build recurs invok prefix extend includ symbol seen transit creat line pattern l u variabl p transit creat line build recurs invok line fig show set pattern along prioriti correspond automaton construct build automaton state sinc state label ident subtre state observ posit interest recal sum size pattern posit integ sequenc encod integ omit detail encod found implement equal use encod symbol specifi posit access without extra overhead compar fixedtravers order final observ automata gener build tree structur also represent use previou pattern match method popular tree stem simplic fact readili support case statement represent space match time complex examin upper lower bound independ travers order space match time complex adapt tree automata sever class pattern fig summar result observ contribut depth automata whose upper bound s space insignific compar exponenti lower bound major contribut come breadth automata furthermor even pattern without variabl ie ground term hard reduc number state wherea reduc breadth not therefor rest paper use breadth measur size automaton present detail lower bound proof proof upper bound establish along line space bound given section independ size pattern number nonvari symbol it class pattern lower bound upper bound lower bound upper bound space space time time unambigu prioriti unambigu prioriti omegagamma n o ambigu figur space match time complex adapt automata n s jl j denot respect number pattern sum size averag size size ith pattern b b b figur exampl matrix b b b b figur matric repres l u state reach transit b travers order establish use flat pattern root symbol f arbitrarili larg ariti shown purpos buid either smallest size automaton one match shortest possibl time flat pattern equival set pattern common prefix u whose fring size equal ariti f thi everi symbol common prefix inspect path final state follow theorem section automaton inspect symbol first larger automaton unambigu unpriorit pattern consid set n nonoverlap pattern alphabet ff a bg variabl sinc flat pattern root symbol f need specifi argument therefor n pattern repres matrix n row ith row list argument f ith pattern column one occurr a one occurr b rest s pair pattern l l least one column wherein l l differ nonvari system unambigu fig show matrix repres four pattern fa a size smallest automaton n pattern pick posit ie column discrimin column contain one nonvari posit transit ie transit b left l u without reduct problem size instanc fig choos column inspect left problem build automaton match basi first six posit pattern word left matrix obtain fig delet last column henc problem still instanc s hand column contain two nonvari base symbol seen column partit n pattern two set consist pattern set must discrimin henc two instanc sn gamma eg exampl inspect posit result pattern set f g f g shown fig henc whose solut unambigu priorit pattern deriv lower bound size automaton unambigu priorit set pattern consid follow set flat pattern textual order prioriti use set pattern construct abov obtain lower bound space omegagamma n follow denot sn size automaton pattern form shown smallest size automaton obtain first inspect cs first column second column on thi shown posit examin automaton thu obtain index follow lemma see section automaton larger automaton consid first state automaton state branch lead subautomaton match pattern therefor whose solut n note averag size pattern lower bound n ambigu pattern consid set pattern use section assum prioriti among pattern observ automata set pattern which must report match sinc prioriti relationship among pattern use automaton priorit system consid previou section thi reach final state v simpli announc match pattern highest prioriti among matchsetv henc automaton cannot smaller pattern prioriti thu arriv lower bound omegagamma n ambigu unpriorit pattern lower bound hold even prioriti allow sinc automata unpriorit pattern use match priorit pattern manner mention abov match time one possibl measur match time averag roottoleaf path length automaton measur exhibit follow anomali suppos automaton properti path automaton correspond path shorter length clearli better match time may reflect averag roottoleaf path length reason may sever path correspond singl path a suppos one path p length anoth path q length also assum two path correspond p length one correspond q length note although path shorter or equal length to correspond path averag path length wherea averag path length good measur suffer anomali averag mean match time pattern mean match time pattern l averag path length path lead match state l quantiti wherea base measur upper lower bound match time given fig bound establish construct use obtain space bound synthes travers order observ build specifi select function present sever techniqu use combin deriv select function improv space match time repres set suppos v state reach see prefix u observ may pattern l u match announc descend v instanc consid pattern fig prefix although l observ match l declar rd argument f b case declar match higher prioriti pattern l inspect posit behalf pattern l wast eg inspect posit u useless sinc irrelev declar match l avoid inspect posit identifi repres set l u minim set consist pattern match announc descend v exampl g repres set form core sever optim discuss later lavil notion access pattern repres set contribut definit yield simpl algorithm comput set definit access pattern yield algorithm use notion compat pattern which correspond match set l u place access pattern observ also use l u place l u follow optim may make optim less effect instanc algorithm directli build optim dag automata see section fail identifi equival state l u use place l u comput l u note pattern l follow properti need present match l identifi term descend v also identifi match anoth pattern of equal higher prioriti term precis definit properti arriv l u repeatedli delet pattern l howev definit immedi lend decis procedur sinc refer infinit number instanc u although set term consid restrict finit set still lead effici procedur sinc theorem comput l u np complet type system proof therem use reduct similar use proof theorem see section omit proof detail here untyp system effici method develop consid l u instanc specif theorem l u comput on time untyp system delet l proof first need show two character l delet equival easi see l satisfi second character also satisfi first one show l satisfi first character also satisfi second let l l k pattern instanc v l u and henc l u also instanc one l l k consid term obtain l u instanti variabl term cannot instanc l unless l l u observ l serv role l second character thu two character equival easili seen comput l u use simpler character done on time note definit l l equal prioriti l one retain l u discard thi choic affect structur automaton current state determin whether match announc l l final state below except choic among pattern second definit specifi l u uniqu final note unambigu system l greedi strategi resort greedi strategi implement function select sinc dynam program approach take exponenti time subautomata exponenti size begin list sever strategi choos p that number distinct nonvari p pattern l u minim number distinct nonvari p pattern l u maxim number pattern nonvari p maxim let l l r match set children v maxjl j jl r j minim sigma r improv space rational strategi follow strategi local minim breadth strategi attempt distinguish quickli among pattern contain potenti exponenti blowup sinc pattern variabl p duplic among children v strategi minim number strategi carri one step minim number duplic strategi attempt minim size largest subautomaton root child v sinc determin size automaton case blowup improv time strategi and also minim number pattern inspect symbol p unnecessari strategi observ worst case time spent match v proport sum size pattern l u quickli discrimin among pattern quantiti rapidli reduc greedi strategi suffer drawback that theorem greedi strategi exist pattern set automata smaller size match time obtain make choic differ given greedi strategi proof strategi consid follow set pattern equal prioriti inspect root strategi choos one posit shown by enumer possibl match automata pattern smallest breadth number state match time obtain choic respect figur reduc respect choos posit construct exampl quit intric key idea make pattern set f g f g f g stronglysequenti wherea set contain two first three pattern one last three not stronglysequenti system prefix u must index select indic propos import strategi suffer drawback strategi key idea select p index u show strategi yield automaton smaller or same size smaller or same match time obtain choic import index known context stronglysequenti system result demonstr applic pattern stronglysequenti specif given subautomata root v select posit p construct anoth subautomata select index q show size match time greater a construct proce seri step interchang order posit q anoth posit seen immedi preced it follow theorem state without proof make construct precis theorem p q v suppos posw q everi child w v order inspect p q interchang without increas size match time automaton repeat interchang obtain a quit interest note repetit interchang step permit restrict condit suffici global rearrang travers order get although theorem assert size match time larger a fig show strictli smaller remark interchang step abov size sometim reduc bya much exponenti factor time on use arbitrari travers order determin compil time appropri function program sinc termin properti program depend travers order therefor programm must made awar travers order apriori given constraint show possibl intern chang travers order way affect termin properti time realiz advantag adapt travers given prefix u suppos travers order select p next posit visit said monoton iff prefix u variabl travers select p unless u p correspond variabl posit l l u travers possess monoton properti includ known travers order depthfirst breadthfirst as well variat without lefttoright bia particular includ fixedtravers order mention earlier lefttoright righttoleft also includ travers use implement stronglysequenti system given monoton travers obtain anoth travers st inspect indic whenev possibl without affect termin properti specif let st denot travers use follow strategi pick posit inspect prefix u ffl u indic arbitrarili select one them ffl otherwis select posit fring u first visit theorem size match time never becom wors st use place path automaton use st examin subset posit examin correspond path minim space use dag previou section discuss synthes travers order order improv space time discuss orthogon approach minim space base share equival state remark transform applic function languag sideeffect omega omega omega oe r f figur exampl illustr size match time reduct due transform figur show automata f b fa a f a textual order prioriti obviou way achiev share use standard fsa minim techniqu optim tree automaton construct build effici method identifi equival two state without even gener subautomata root state observ tree automaton may exponenti larger dag automaton case naiv approach use exponenti time space wherea direct construct potenti use polynomi space polynomi time import problem directli build optim automata even restrict lefttoright travers remain open propos solut problem identifi equival state suppos two prefix u u repres set l u differ posit p everi pattern l u variabl p sinc posit irrelev determin match two prefix equival hand also shown differ repres set differ posit equival base observ defin relev prefix u term obtain replac subterm posit p symbol instanc prefix correspond differ state mark s fig differ relev prefix fx b show two state equival iff correspond relev prefix ident theorem automaton obtain merg state ident relev prefix optim merg equival state describ substanti reduc space requir automata eg tree automaton fig state reduc share also recal pattern fig part automaton reach posit transit alon exponenti show share state part automaton becom polynomi impact dag space match time complex sinc share affect space requir alon result establish far relat space such theorem time continu hold dag well follow discuss impact dag result establish earlier regard space show upper bound size dag automata o n s much smaller correspond bound o automata also establish lower bound o n ambigu pattern unambigu pattern clear whether lower bound size exponenti instanc appear pattern use lower bound proof size tree automata unambigu pattern possess polynomials dag automaton reason lower bound becom extrem complic dag sinc difficult captur behavior share formal final greedi strategi well strategi select indic can case increas space dag automata failur index select strategi demonstr complex share recal index prefix u posit fring must inspect announc match pattern l u absenc prioriti posit must inspect announc match pattern l exactli fring posit wherein l nonvari prioriti howev may inspect posit wherein l variabl order rule match higher prioriti pattern obviou variabl posit l must inspect clear comput indic priorit system therefor lavil propos indirect method index comput first transform priorit pattern equival set unpriorit pattern use index comput pattern l transform gener set l instanc instanc higher prioriti pattern for type system instanc observ type disciplin gener transform system l puel suarez develop compact represent set l base notion constrain term term constraint place substitut taken variabl them instanc constrain term feqx yjx a y bg denot set term precis semant constrain term given first regard term variabl denot set it instanc constrain term ftjg denot set instanc also satisfi constraint formula defin constraint formula first defin atom constraint form form x s x variabl variabl unnam former case term satisfi constraint must belong set it gamma is latter case substitut taken x must instanc s arbitrari constraint obtain combin atom constraint use constraint satisfi and onli term satisfi either similarli constraint satisfi and onli term satisfi well final note type system alway implicit constraint impos type disciplin requir variabl substitut term type variabl henceforth may use sever method simplifi constrain term method quit intuit correct readili follow semant use constrain term set l repres compactli fljl pattern prioriti greater l constraint l l simplifi constraint variabl l simplifi constraint l l first check two pattern unifi not constraint simplifi true otherwis let x variabl l substitut nonvari term say unifi l l simplifi constraint use procedur simplif constraint pattern l done os time illustr consid follow exampl defin equal enumer data type prevent constraint x ay b complic develop materi rest section note two among first n pattern unifi condit vacuous henc first n pattern appear unchang transform system last rule howev unifi everi rule get translat condit ith disjunct prevent instanc ith pattern recogn instanc last rule seen abov constraint cnf clear indic obtain them puel suarez simplifi dnf make structur term set denot constrain term appar instanc constrain term simplifi to note type system constraint x x simplifi fals constraint simplifi x constrain term dnf indic prefix u wrt c easili pick follow firstli variabl posit u wherein nonvari symbol index u secondli consid variabl posit p wherein variabl x constraint substitut x appear everi conjunct note term instanc constrain term must satisfi one constraint m sinc x appear everi one conjunct substitut must examin order determin whether term satisfi constraint therefor posit also indic u convers constraint pattern l cnf dnf expens take ojlj n time therefor puel suarez algorithm base convers exponenti time complex type untyp system lavil algorithm also exponenti type untyp system contrast present first polynomialtim algorithm untyp system oper directli origin pattern algorithm index comput untyp system index prefix comput two step first comput set indic prefix wrt constrain pattern l u intersect set thu comput yield indic prefix wrt l u comput indic prefix u wrt singl constrain pattern l follow pattern l u prioriti l also unifi l follow two step specifi indic u wrt l variabl x u l nonvari posit correspond x variabl x must posit instanti l tu determin match higher prioriti pattern l j remark similar algorithm suggest lavil heurist fast index comput howev question power or complet heurist address all illustr algorithm l with textual order prioriti prefix z observ x z indic l step index l x step observ step yield addit indic l l z index step x index step with l intersect posit x therefor index u index comput take time use algorithm show theorem algorithm comput indic untyp system sound complet proof need establish algorithm comput indic u wrt constrain pattern l clearli posit comput use step index wrt l c posit select use step observ constraint l l j simplifi x term t constraint appear everi conjunct dnf fl posit select step thu indic l c complet need show posit p u select step index l c accomplish give instanc l c variabl p suppos p select step step l must case either l p variabl one posit fring l u need instanti determin match l either case disjunct obtain simplifi l l contain least one liter differ lp consid obtain l u substitut x s mention abov note substitut variabl l u satisfi constraint l c henc instanc l still variabl p prove p index u type system unlik escap exponenti complex sinc show intuit reason complex gap type untyp system draw analog index comput constrain term satisfi problem note liter constraint gener puel suarez algorithm form x x variabl arbitrari term constrain term analog boolean formula neg liter boolean formula trivial satisfi by truth assign assign fals everi liter similarli index comput simpl untyp system howev type system implicit posit constraint introduc type disciplin instanc implicit constraint constrain term thu constraint contain posit neg liter constrain term analog boolean formula posit neg liter henc complex gap proof index select problem pose decis problem take form doe u possess index wrt pattern set l show problem conp need show problem decid whether p index np thi let r set fring node u first guess r instanc u p variabl r verifi instanc at least one pattern l declar u index clearli accomplish polynomi time henc problem determin whether u possess index np index select problem conp show problem conp complet reduc complement satisfi problem let instanc satisfi problem disjunct liter form x x x fx g transform index comput problem follow system consist n pattern textual order prioriti root pattern symbol f which stand common prefix share pattern argument last argument f type consist nonvari b n th pattern form fx specifi first n term unifi other also assum term type unifi term specifi ith pattern for b depend upon whether x j x j occur neither occur j variabl observ size pattern set polynomi size construct show determin whether index equival determin whether first transform pattern set set constrain pattern follow transform n th pattern becom slightli abus notat replac x j x j x j b ie x j type disciplin x j use heurist constraint simplifi show fx xm index name x iff input sat problem satisfi heurist fast index comput type system suppos constrain term form disjunct contain occurr x suppos exist term valid type x equal then rule indic obtain constraint exactli obtain constrain term term valid type x then rule consist singl variabl y index power rule evid fact order appli need identifi variabl x constraint x simplifi fals x identifi avoid expand fl n term instead concern two term expans name illustr power rule consid constrain term note x x simplifi fals s which form also contain say reduc fals mean satisfi ie contradict one variabl henc index interchang role x also note x index note comput indic taken time linear sum size rule contrast puel suarez algorithm spend exponenti time reduc constraint dnf proof correct rule expand fl take conjunct ffi get ffl disjunct term contain least one constraint x s first term expans constrain x therefor variabl x appear index unless appear everi conjunct dnf ffi furthermor sinc x apear term expans except fl clear x index iff fl reduc fals exactli captur consid x proof rule expand fl elimin term reduc fals observ everi conjunct expans contain least one form conjunct dnf constrain index conclud remark paper studi pattern match adapt automata present lower upper bound worstcas size automata sever class pattern discuss improv space match time synthes travers order show good travers order select indic whenev possibl use one greedi strategi especi strategi otherwis although greedi strategi may sometim fail appear complex counter exampl failur may rare function program synthes travers st monoton travers sinc use st affect termin properti programm assum wherea implement benefit signific improv space match time also discuss orthogon approach space minim share equival state recal even index select strategi may fail improv space dag automata occur index select may advers affect way descend state share sinc difficult predict share among descend state possibl improv space without use indic appear practic best approach use strategi section use share addit sourc space optim tree automata work clearli bring forth impact type priorit pattern match shown sever import problem context pattern match unlik polynomialtim algorithm type system wherea given polynomialtim algorithm untyp system rais question whether worthwhil consid type pattern match clear often type inform use find index or determin pattern belong l u cannot found otherwis hand signific penalti term comput effort problem use type inform r complex trie index construct definit standard ml report haskel comput nonambigu linear term rewrit system lazi pattern match ml languag implement lazi pattern match algorithm fast parallel implement function languag equal experi refin compil pattern match function languag tr effici compil pattern match tr ctr nadia nedjah minim determinist lefttoright patternmatch automata acm sigplan notic v n januari nadia nedjah luiza de macedo mourel effici concis determinist patternmatch automata ambigu pattern acm sigplan notic v n februari per gustafsson konstantino sagona effici manipul binari data use pattern match journal function program v n p januari r sekar i v ramakrishnan andrei voronkov term index handbook autom reason elsevi scienc publish b v amsterdam netherland