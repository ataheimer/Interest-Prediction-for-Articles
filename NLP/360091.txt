t separ transpar layer use focu a consid situat depth point scene multivalu due presenc virtual imag semireflect transpar surfac semireflect imag linearli superimpos imag object behind transpar surfac novel approach propos separ superimpos layer focus either layer yield initi separ crosstalk remain separ enhanc mutual blur perturb compon imag howev blur requir estim defocu blur kernel thu propos method self calibr blur kernel given raw imag kernel sought minim mutual inform recov layer autofocus depth estim presenc semireflect also consid experiment result present b introduct situat sever typic two linearli superimpos contribut exist often encount realworld scene exampl look car or room window see outsid world term real object semireflect object insid term virtual object treatment case import sinc combin sever unrel imag like degrad abil analyz understand them detect phenomenon import itself sinc indic presenc clear transpar surfac front camera distanc closer imag object term transpar layer use describ situat scene semi reflect transpar surfac mean imag decompos depth order layer associ map describ intens and applic motion adopt terminolog stress fact work deal imag object variabl opac approach recov layer null other reli mainli triangul method like motion stereo algorithm develop cope multipl superimpos motion field ambigu solut discov anoth approach problem base polar cue howev approach need polar filter oper camera may unstabl angl incid low dicult gener case two layer exist recent year rang imag reli limit depth field dof lens gain popular approach depth estim use monocular system base focu sens term depth focu dff computervis literatur approach scene imag dierent focu set eg axial move sensor object len thu obtain imag slice scene slice limit rang depth focu depth extract search slice maxim focu criterion usual relat two dimension intens variat region correspond plane best focu dff imagebas render base focus slice usual perform opaqu and occlud layer particular recent method present gener arbitrarili focus imag special eect perform separ occlud layer physic model dof appli process imag transpar object long consid field microscopi defocu eect pronounc algorithm dff demonstr layer microscop object due small depth field use interf layer blur reconstruct process necessari note microscop specimen usual contain detail continuum depth correl adjac layer crosstalk disturb semireflect fundament consequ imag oper eg loss bicon region three dimension frequenc domain pose limit reconstruct abil relat tomographi discov three dimension reconstruct method use microscopi may applic case discret layer well studi possibl exploit limit depth field detect separ recov intens distribut transpar multivalu layer focus yield initi separ crosstalk remain layer separ base focus imag chang len apertur crosstalk attenu mutual blur disturb compon imag section proper blur requir point spread function psf imag well estim wrong psf leav recov layer contamin complementari therefor studi eect error psf then propos method estim psf raw imag section base seek minimum mutual inform recov layer recoveri experi describ section also discuss implic semireflect focus process depth extract section preliminari partial result present recoveri focus slice use two focus slice consid twolay scene suppos either manual automat procedur see section acquir two imag imag one layer focu assum moment also estim blur kernel oper layer camera focus one assumpt may satisfi imag system design calibr due chang focu set imag may undergo scale chang telecentr imag system fig use problem avoid otherwis assum scale chang correct preprocess let layer f superimpos layer f consid slice g g b either layer f layer f respect focu layer blur model blur convolut blur kernel the assumpt spaceinvari respons constant depth object common analysi defocus imag approxim true paraxi system system correct aberr telecentr system use h depth depend scale chang typic neglect superposit linear sinc realvirtu layer imag object multipli transmissionreflect coecient semireflect surfac coecient depend light intens physic process transparentsemireflect scene describ ref nonlinear transmiss reflect eect as appear photorefract crystal neglig intens materi typic imag applic f figur telecentr imag system apertur situat distanc f the focal length front len object point distanc u best focu sensor v sensor v imag point blur spot parameter eectiv diamet d frequenc domain eq take form assum kernel symmetr imh real compon g g b respect reg similar express imaginari compon imag equat visual two pair straight line see fig solut correspond line intersect uniqu exist h h b sinc imag system cannot amplifi compon h b h uniqu intersect exist unless h gain insight consid telecentr system the gener straightforward case h h slope line fig repres constraint reciproc other h slope two line becom similar henc solut sensit nois g g b frequenc decreas h henc frequenc transvers domainh f g g f fg g f figur visual constraint reconstruct focus slice converg suggest algorithm frequenc relat real compon g g b f f take form two straight line visual imaginari part similar low frequenc recoveri ill condit due energi conserv averag gray level dc aect defocus thu dc h noiseless case constraint dc compon coincid singl line impli infinit number solut presenc nois line becom parallel solut recoveri dc compon thu ill pose phenomenon also seen three dimension frequenc domain imag space band limit miss cone frequenc whose axi axial frequenc direct v apex origin recoveri averag intens individu layer imposs sinc inform interlay variat averag transvers intens miss cone similar conclus may deriv observ three dimension frequenc domain support reli diract limit optic order obtain anoth point view diculti consid naiv invers filter approach problem given eq transvers spatial frequenc domain reconstruct henc solut instabl note howev problem well pose stabl high frequenc sinc h lpf b high frequenc seen eq high frequenc content slice layer focu retain slice diminish even high frequenc nois ad imag acquisit amplifi slightli reconstruct behavior quit opposit typic reconstruct problem instabl nois amplif appear high frequenc iter solut suggest similar invers problem microscopi field similar approach use gener special eect occlud layer invers filter need special care low frequenc compon method consid visual progress along vector altern direct parallel axe fig converg solut initi hypothesi h h decreas roughli speak frequenc increas constraint line approach orthogon thu converg faster singl iter describ fig version vancittert restor algorithm slice g g b initi hypothes respect lth iter schechnerijcvfigp figur step iter process initi hypothes layer serv input imag process step base eq new estim fed back input next iter odd l bm major eect amplif nois ad raw imag g g b with nois unfocus slice attenu h again see high frequenc amplif addit nois approach frequenc decreas nois amplif increas addit dc error increas linearli m let us defin basic solut result use indic recoveri directli without iter calcul kernel filter beforehand paramet control close filter bm invers filter analog regular paramet typic invers method spatial domain eq turn convolut kernel z z h b h z z twice z h b h h b h z z time spatial support b approxim dm pixel wide blur diamet assum moment kernel similar support here finit support imag taken account larger is larger disturb eect imag boundari unknown surround aect larger portion imag therefor prefer limit even absenc nois diculti seem indic basic limit abil recov layer blur diamet larg small use initi layer estim achiev focus cannot improv much case initi slice alreadi show good separ individu layer sinc two slice one layer blur thu hardli disturb one hand small slice one layer focus nearli focus creat confus imag then abl enhanc recoveri use larger small eect imag boundari use larger lead howev nois amplif greater sensit error assum psf see subsect exampl simul scene consist imag lena close object seen reflect window mt shuksan seen origin layer appear top fig layer focus blur gaussian kernel standard deviat std pixel slice layer focus shown second row fig all imag work present contraststretch reconstruct mirror extrapol use surround imag order reduc eect boundari basic solut remov crosstalk imag lack contrast due attenu low frequenc use equival iter improv balanc low frequenc compon high one larger ms result similar courtesi bonni lorim schechnerijcvfigp solut basic origin far layer close layer solut enhanc slice focus figur simul result focus slice one origin layer focus defocu blur basic solut correct kernel remov crosstalk low frequenc content imag low approxim invers filter term amplifi low frequenc compon similar motionbas separ separ transpar layer fact high frequenc easili recov low one noisi lost uniqu approach also appear result obtain use motion note that like focu chang motion leav dc compon unvari result motionbas recoveri semireflect scene clearli highpass filter version superimpos compon algorithm present demonstr setup similar one object domin easili seen even domin object fade recoveri consider lowfrequ contamin remain shizawa mase shown that region translat motion spatiotempor energi layer resid plane pass origin spatiotempor frequenc domain idea use gener null filter elimin contribut layer thu isol singl one howev two frequenc plane common frequenc line pass origin the dc whose compon thu gener insepar similar exampl unif triangul dof approach discuss gener ref show depth focu defocu approach manifest geometr triangul principl exampl shown system dimens depth sensit stereo motion blur defocu blur system basic same along line similar inher instabl separ base motion focu surpris use focus slice pinhol imag anoth approach layer separ base use input pinhol imag focus slice rather two focus slice acquir one imag via small apertur pinhol camera lead simpler algorithm sinc singl slice one layer focu need advantag two imag taken without chang axial posit system compon henc geometr distort aris acquisit imag practic imposs microscopi due signific diract eect associ small object possibl system inspect macroscop object pinhol imag describ a attenu intens due contract apertur imag use conjunct one focus slice eq exampl g invers filter solut subsect approxim eect error psf algorithm suggest subsect comput bmg g b h normal assum eq g assumpt hold bm note that regardless precis form psf imag psf psf use recoveri equal reconstruct would converg f h b h practic imag psf slightli dierent ie g f f f function spatial frequenc dierenc may due inaccur prior model imag psf due error depth estim reconstruct process lead e similar relat obtain layer error psf lead contamin recov layer complementari larger is stronger amplif disturb note monoton increas m within support blur transfer function h b h case recoveri psf gaussian note usual low frequenc which regim crosstalk h b h thu may expect best sens separ achiev use small m actual one iter provid least contamin although uncontamin solut obey increas word decreas reconstruct error necessarili lead less crosstalk h f h of layer lowpass filter conserv averag valu imag henc e low high frequenc ie e bandpass filter howev bm amplifi low frequenc low frequenc combin eect may finit infinit limit depend psf model use continu exampl shown fig imag psf std pixel eect use wrong psf reconstruct demonstr fig psf use reconstruct std pixel neg trace remain ie brighter area one imag appear darker area other psf use reconstruct std pixel posit trace remain ie brighter area one imag appear brighter other contamin slight basic solut notic larger ms is b so separ seem wors even though imag better balanc due enhanc low frequenc schechnerijcvfigp r r r far layer close layer r figur simul imag use wrong psf reconstruct origin blur kernel std r pixel crosstalk recov layer seen clearli std kernel use pixel contamin increas m perform analysi method describ subsect one filter involv h sinc layer f focus suppos that addit use h reconstruct rather true imag transfer function f h inaccur use scalar rather true valu use imag process let e denot rel error paramet e a aa obtain e e result imag defocu kernel one use reconstruct a note import estim e defocus layer recov uncontamin f howev even case e focus layer contamin f amplifi seek blur kernel recoveri method outlin section base use known estim blur kernel imag system design calibr addit depth estim layer obtain focus process eg describ section may know kernel apriori gener howev kernel unknown even apriori knowledg sometim inaccur thu wish achiev selfcalibr ie estim kernel imag themselv enabl blind separ restor layer that need criterion layer separ note method estim blur kernel base minim fit error dierent layer may fail case layer transpar uniqu blur kernel point moreov fit error criterion separ assum statist depend real virtual layer small even zero reason sinc usual origin unrel scene kullbackleibl distanc measur far imag statist independ indic mutual inform let probabl certain valu practic probabl estim histogram recov imag joint probabl practic estim joint histogram imag is rel number pixel f certain valu f certain valu f correspond pixel mutual inform approach assum layer correctli separ estim contain minimum inform other mutual inform suggest use criterion align maximum sought use measur look highest discrep imag thu minim it distanc eq depend quantiz dynam rang turn depend bright individu layer f f decreas depend paramet perform two normal first estim layer contraststretch standard dynam rang then normal mean entropi estim layer treat individu imag self inform entropi f express f similar measur use indic ratio mutual inform self inform layer recov layer depend kernel use therefor problem seek kernel state minim problem accord subsect error kernel lead crosstalk contamin estim layer expect increas mutual inform gener mani degre freedom form kernel hand kernel constrain nonneg conserv energi etc simplifi problem kernel assum gaussian then kernel parameter standard deviat proport blur radii limit may lead solut suboptim easier obtain anoth possibl criterion separ decorrel decorrel necessari condit recoveri semireflect layer independ compon analysi polar analysi note requir decorrel estim layer base assumpt origin layer decorrel assumpt usual approxim illustr use criteria search optim blur kernel separ imag shown second row fig simplifi calcul restrict kernel isotrop gaussian std inde kernel use synthesi henc correl mutual inform function singl variabl seen fig use correct kernel with std pixel yield decorrel basic solut minim mutual inform i n plot posit correl larger valu assum std neg correl smaller valu consist visual appear posit neg trace fig observ that expect theori fig crosstalk stronger larger m inde fig absolut correl mutual inform greater wrong kernel use dierent simul focus slice correspond origin layer shown top fig creat use exponenti imag kernel rather gaussian std sampl grid demonstr practic implement prefer use ecient search algorithm optim mutual inform schechnerijcvfigp normal inform correl m mutual inform figur assum kernel std pixel basic solut decorrel minim mutual inform shown normal consist true std dash absolut correl mutual inform larger larg valu m std still recoveri done gaussian kernel correl mutual inform curv as function assum std similar seen fig minim mutual inform howev std r pixel visibl crosstalk result imag blur along sensor raster row may dierent blur along column blur caus optic process also interpixel crosstalk sensor raster read process ccd moreov interpixel space along sensor row gener dierent along column thu even optic blur may aect dierent assign dierent blur radiu axi r row r column two slice use subsect two kernel total four paramet defin paramet vector p r row estim vector p singl focus slice use conjunct pinhol imag describ subsect problem much simpler three paramet determin r row a paramet easier obtain indic ratio light energi wideapertur imag rel pinhol imag ideal squar reciproc ratio fnumber camera two state if howev optic system calibr automat gain control sensor ratio adequ estim a estim ratio averag valu imag exampl approxim may serv start point better estim use decorrel criterion multiparamet case may numer paramet combin lead decorrel lead minimum mutual inform good separ p ndimension zerocorrel constraint defin dimension hypersurfac paramet space possibl use criterion obtain initi estim p search minim mutual inform within lower dimension manifold exampl combin r row r column lead decorrel found near rough estim base intens ratio search minimum mutual inform limit subspac two paramet recoveri experi recoveri two focus slice print portrait doctor gachet by vangogh posit close behind glass window window partli reflect distant pictur part print parasol by goya f two focus slice shown top fig cross correl raw focus imag normal mutual inform n indic signific separ achiev focus process substanti crosstalk remain optim paramet vector p sens minimum mutual inform pixel r b correspond blur close layer r correspond blur far layer paramet basic solut shown middl row fig n two order magnitud better raw imag use better balanc low high frequenc compon n increas believ due error psf model discuss abov anoth exampl print portrait armand roulin by vangogh posit close behind glass window window partli reflect distant pictur print part miracl san antonio by goya seen fig portrait hardli visibl raw imag cross correl raw focus imag normal mutual inform n optim paramet vector system telecentr slight magnif chang focu set compens manual resiz one imag solut basic close layer far layer slice focus figur top slice either transpar layer focus middl row basic solut bottom row recoveri close layer far layer focus slice basic solut figur top slice either transpar layer focus middl row basic solut bottom row recoveri pixel paramet n basic solut rise third exampl scene consist distant vase pictur partlyreflect glasscov closer crab pictur imag system telecentr magnif correct need focus slice recov layer shown fig focus slice n cross correl far layer close layer figur top slice either transpar layer focus bottom basic solut recoveri crab left vase right layer optim paramet vector p sens minimum mutual inform pixel basic recoveri use b shown bottom fig crosstalk significantli reduc mutual inform n correl decreas dramat respect recoveri focus slice pinhol imag scene consist print portrait armand roulin close layer print part miracl san antonio far layer imag system telecentr lead magnif chang focus thu system may prefer use fix focu set chang apertur imag acquisit pinhol imag acquir use state correspond mark len layer focus layer defocus layer defocus layer focus figur top left slice far layer focus view wide apertur top right pinhol imag middl row basic recoveri bottom row recoveri wide apertur imag acquir use state correspond stress calibr len mark necessarili correspond true valu slice far layer focus use wide apertur shown top left fig pinhol imag top right presenc portrait layer notic accord ratio fs wide apertur imag brighter pinhol imag howev ratio mean intens wide apertur imag pinhol imag could due poor calibr len manufactur automat gain control sensor ad set paramet search optim process order get addit cue a calcul ratio statist measur ratio std median mean absolut deviat respect thu let assum valu exampl demonstr possibl use decorrel limit minimum mutual inform search first hypothes pair blur diamet paramet led decorrel basic solut sought then mutual inform calcul paramet caus decorrel blur diamet led minim mutual inform pixel best paramet reconstruct result shown middl row fig mutual inform normal use larger paramet increas mutual inform look better estim minim mutual inform applic bm result paramet dierent r row r pixel recov layer shown bottom row fig mutual inform normal discuss befor increas probabl due inaccur model blur kernel obtain focus slice use standard focus techniqu far assum focus slice known consid acquisit use focus depth focu dff algorithm depth sampl chang focu set particularli sensor plane accord ref sampl depth field interv x x interpixel period similar stereo imag system telecentr imag side prefer configur sinc ensur constant magnif sensor put focu system easi show geometricalopt blurkernel diamet apertur width f focal length see fig v distanc sensor plane plane best focu axial sampl period therefor v fxd sampl period requir also analyz frequenc domain focu calcul appli imag slice acquir basic requir focu criterion reach maximum slice focu criteria suggest literatur sensit two dimension variat slice local focu oper yield slice local focusmeasur focu x y v v axial posit sensor see fig want find depth certain region patch scene compos singl layer averag focu x y v region obtain focu v singl valu depth estim approach inadequ presenc multipl layer ideal alon would lead main peak focu v but due mutual interfer peak move origin posit even merg singl peak averag posit thu spoil focu detect phenomenon observ experiment result scene focus slice shown fig craband vase object distanc m m len respect detail experiment imag system describ depth variat within object neglig respect depth field interest note mathemat proof exist valid focu criterion complet base local calcul depend transvers neighbor function axial posit intens transvers point extremum plane best focu secondari maxima though due unmonoton frequenc respons blur oper due edg bleed howev mislead maxima usual much smaller maximum associ focus featuredens region edg extens std psf pixel accomplish move sensor array mm plane best focu extend eectiv width kernel pixel d pixel also consist subject sensat dof result focu search shown dasheddot line fig indic focu measur fail detect layer yield singl merg peak somewher focus state individu layer demonstr confus convent autofocus devic appli transpar scene vote scheme toward solv merg problem observ layer gener unrel edg usual spars thu posit bright edg two layer sporad coincid sinc edg and featuredens region domin contributor focu criterion would wise mix brute averag local focu measur entir region point x y edg one layer smooth region layer peak focu x y v correspond edg greatli aect contribut layer follow approach propos pixel x y slice focu measur focu x y v analyz function v find local maxima result express binari vector local maxima posit then vote tabl analog histogram maxima locat pixel form sum hit sliceindex vote given weight depend correspond valu focu x y v enhanc contribut high focusmeasur valu aris edg reduc random contribut featureless area result vote method shown solid line fig demonstr success creat signific separ peak near plane best focu measur rate increas std function defocu much lower expect geometr consider believ due notic diract spheric aberr eect regim schechnerijcvfigp slice index vote weight tradit measur focu figur experiment result dasheddot line convent focu measur function slice index mistakenli detect singl focus state th slice solid line locat histogram detect local maxima focu measur the scene highest number vote posit local maxima correctli accumul th th slice true focus slice correspond focus layer addit detail found estim depth correct within uncertainti impos depth field system optim design rigor perform evalu dff method presenc transpar remain open research problem conclus paper present approach base focus separ transpar layer appear semireflect scene approach stabl respect perturb occlus separ method reli stereo motion also present method self calibr defocu blur kernel given raw imag base minim mutual inform recov layer note defocu blur motion blur stereo dispar similar origin dier mainli scale shape kernel therefor method describ could possibl adapt find motion psf stereo dispar transpar scene case method present also applic multipl layer opac variat within close layer small a weak object transpar eect may approxim linear superposit layer done microscopi microscopi tomographi suggest method self calibr psf improv remov crosstalk adjac slice analysi experi depth variat within layer neglect approxim hold long depth variat small respect depth field extend analysi recoveri method deal spacevari depth blur interest topic futur research simplifi interim approach could base applic filter small domain depth variat sucient small note mutual inform recoveri criterion still appli global lead higherdimension optim problem believ fundament properti inabl recov dc layer hold gener case obviou improv perform approach achiev incorpor ecient search algorithm solv optim problem ecient way estim mutual inform semireflect also separ use polar cue interest note polar base recoveri typic sensit high frequenc nois low angl incid hand dc recoveri gener possibl particular diculti low frequenc nice complement characterist focusbas layer separ recoveri high frequenc stabl problem aris low frequenc fusion focu polar cue separ semireflect thu promis research direct abil separ transpar layer util gener special eect exampl ref imag render occlud opaqu layer defocus move enhanc arbitrarili eect possibl interest one gener scene contain semireflect acknowledg work conduct yoav y schechner depart electr engi neer technion israel institut technolog haifa thank joseph shamir alex bekker advic support signific help make facil elec trooptic laboratori electr engin depart technion avail us thank bonni lorim permiss use photograph mt shuksan research support part eshkol fellowship isra ministri scienc ol lendor center depart electr engin technion telaviv univers research fund vision group weizmann institut support part isra ministri scienc grant no ronen basri incumb ary dissentshik career develop chair weizmann institut r activ stereo integr dispar optic section microscopi cellular architectur three dimens reduct boundari artifact imag restor produc objectbas special eect fuse multipl dierent focus imag threefram algorithm estim twocompon imag motion estim multipl depth semitranspar stereo imag digit imag process three dimension radiograph imag restrict view angl enhanc d reconstruct confoc scan microscop imag element inform theori separ transpar motion layer use velocitytun mechan null filter separ transpar mo tion pyramid base depth focu represent biostructur imag optic microscop acquisit d data focu sens reconstruct d lightmicroscop imag digit imag process separ reflect imag use independ compon analysi distribut actinin singl isol smooth muscl cell simpl focus criterion comput occlud transpar motion digit optic microscopi extend depth field resolut enhanc spectra perspect rangefind techniqu comput vision panoram imag acquisit registr blur estim method multipl di linear nonlinear program miss cone problem lowpass distort optic serial section microscopi artifact comput opticalsect microscopi robust focu rang shape focu system real time focu rang sensor microscop shape focu use activ illumin theori specular surfac geometri regular linear method reconstruct threedimension microscop object optic section depth defocu vs stereo di optim axial interv estim depth defocu separ transpar layer use focu separ transpar layer polar analysi vision semireflect media polar analysi blind recoveri transpar semireflect scene polar statist analysi scene contain semireflector three dimension optic transfer function annular len visual ambigu due transpar motion stereo direct estim multipl dispar transpar multipl surfac binocular stereo simultan multipl optic flow estim fundament restrict d light distribut optim focu measur passiv autofocus depth focu digit composit imag increas depth focu consid depth inform textureless scene recover defocu detect use visibl criterion iii yearyear align maxim mutual inform layer represent motion analysi telecentr optic comput vision percept multipl transpar plane stereo vision depth focus defocus jayasooriah sinniah tr ctr thanda oo hiroshi kawasaki yutaka ohsawa katsushi ikeuchi separ reflect transpar layer realworld imag sequenc machin vision applic v n p januari javier toro frank owen rubn medina use known motion field imag separ transpar pattern recognit letter v n p januari dm tsai cc chou fast focu measur video display inspect machin vision applic v n p juli amit agraw ramesh raskar shree k nayar yuanzhen li remov photographi artifact use gradient project flashexposur sampl acm transact graphic tog v n juli morgan mcguir wojciech matusik hanspet pfister john f hugh frdo durand defocu video mat acm transact graphic tog v n juli sarit shwartz michael zibulevski yoav y schechner fast kernel entropi estim optim signal process v n p may zhang shree nayar project defocu analysi scene captur imag display acm transact graphic tog v n juli marc levoy ren ng andrew adam matthew footer mark horowitz light field microscopi acm transact graphic tog v n juli