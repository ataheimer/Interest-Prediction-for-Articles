t inner class a inner class objectori languag play role similar nest function definit function languag allow object export object direct access method instanc variabl howev similar decept close look inner class reveal signific subtleti aris interact inherit goal work precis understand essenti featur inner class object studi fragment java inner class inherit and almost noth els begin give direct reduct semant languag give altern semant translat yet smaller languag toplevel class close follow java inner class specif prove two semant coincid sens translat commut reduct typesaf b introduct often observ gap objectori function program style larg might first appear essenc object record function closur howev differ well similar one hand object class incorpor import mechan present function static member inherit object ident access protect etc hand function languag usual allow nest definit function give inner function direct access local variabl enclos definit objectori languag support sort nest exampl smalltalk special syntax block object similar anonym function beta provid pattern unifi class function nest arbitrarili recent inner class popular inclus java inner class use object need send anoth object chunk code manipul first object method andor instanc variabl situat typic userinterfac program exampl java abstract window toolkit allow listen object regist userinterfac compon button button press actionperform method listen invok exampl suppos want increment counter button press begin defin class counter inner class listen class counter int x class listen implement actionlistn public void actionperformedactionev e x void listentobutton b baddactionlistenernew listen definit method actionperform field x enclos counter object chang method listento creat new listen object send given button write counter new counter new buttonincr creat display button increment counter everi time press inner class power abstract mechan allow program like one express much conveni transpar would possibl use toplevel class howev power come signific cost complex inner class interact featur objectori programmingespeci inheritancein quit subtl way exampl closur function languag simpl lexic environ includ bind whose scope appear inner class hand access via method inherit superclass chain environ includ lexic environ appear also lexic environ superclass convers presenc inner class complic intuit inherit mean exampl inner class inherit enclos class happen toplevel class inherit inner class defin differ toplevel class javasoft inner class specif provid one answer question show translat program inner class one use toplevel class ad inner class extra field point instanc enclos class specif give clear basic intuit behavior inner class fall short complet satisfi account first style indirect forc programm reason code first pass rather heavi transform second document somewhat imprecis consist exampl english prose differ compil even differ version sun jdk interpret specif differ signific detail goal work precis understand essenti featur inner class main contribut threefold ffl first give direct oper semant type rule small languag inner class inherit type rule shown sound oper semant standard sens keep model simpl possibl focu basic form inner class java omit relat mechan anonym class local class within block static nest class also deal import interact access annot publicprivateetc inner class cf ffl next give translat languag inner class even smaller languag toplevel class formal translat semant java inner class specif show translat preserv type ffl final prove two semant defin behavior inner class sens translat commut highlevel reduct relat direct semant basi work core calculu call featherweight java fj calculu origin propos context formal studi gj extens java parameter class design omit mani featur java possibl even assign maintain essenti flavor languag type system definit fit comfort page basic properti prove difficulti than say simpli type lambdacalculu subtyp extrem simplic make ideal vehicl rigor studi new languag featur parameter class inner class remaind paper organ follow section briefli review featherweight java section defin fji extens fj inner class give syntax type rule reduct rule state standard type sound result section defin compil fji fj model translat semant inner class specif prove correct respect direct semant previou section section offer conclud remark breviti proof theorem omit appear forthcom technic report begin review basic definit featherweight java fj tini fragment java includ toplevel class definit object instanti field access method invoc the origin version fj also includ typecast requir model compil gj java omit here sinc interact inner class signific way sinc fj sublanguag extens defin section show syntax exampl program execut here rest definit found figur abstract syntax fj class declar constructor declar method declar express given follow class c extend c c f k m e x new ce metavari a b c d e rang class name f g rang field name rang method name x rang paramet name c e rang express l rang class declar k rang constructor declar rang method declar write f shorthand f fn and similarli c x e etc write shorthand mn with comma write empti sequenc ffl denot concaten sequenc use comma length sequenc x written x abbrevi oper pair sequenc obviou way write c f shorthand c f cn fn c f shorthand c f cn fn thisff shorthand thisf f thisf n fn sequenc field declar paramet name method declar assum contain duplic name key simplif fj omiss assign make fj pure function object field initi constructor never chang afterward moreov constructor styliz syntax one paramet field name field super constructor invok field supertyp remain field initi correspond paramet these constraint enforc type rule styliz syntax make oper semant simpl field access express new cef reduc correspond constructor argument e also sinc fj assign statement method bodi alway consist singl return statement comput languag goe express follow return method invoc express new cemd reduc look express e follow return method class c class tabl reduc instanc e receiv object new ce substitut formal argument special variabl thi respect figur state reduct rule precis program fj pair class tabl a set class definit express correspond main method java program reduct relat form e gamma e reduc express e one step exampl given class definit cours use exampl program inner class involv sideeffect featur java howev core mechan inner class interact assign interest way omit assign fj fji obtain much simpler model offer much insight inner class class pair extend object object fst object snd pairobject fst object snd pair setfstobject newfst return new pairnewfst thissnd class extend object class b extend object express new pairnew a new bsetfstnew b reduc new pairnew b new b follow new pairnew a new bsetfstnew b gamma new pairnew b new pairnew a new bsnd gamma new pairnew b new b underlin subexpress one reduc step fj inner class defin languag fji extend fj inner class like fj fji impos syntact restrict simplifi oper semant receiv field access method invoc inner class constructor invoc must explicitli specifi no implicit thi type name alway absolut path class denot no short abbrevi inner class instanti express enew ce annot static type e written enewt ce condit fji quit subset java wherea fj is instead view fji intermedi languag user program translat process elabor describ elabor process inform here sinc rather complex especi deep consist mainli larg number rule abbrevi long qualifi name detail treatment given companion technic report begin brief discuss key idea enclos instanc section discuss interact inner class subclass section final arriv formal definit syntax fji import auxiliari definit oper semant type relat statement subject reduct progress properti finish section enclos instanc consid follow fji class declar class outer extend object pair outerpair p super class inner extend object object sndp return outerthispsnd outerinn makeinn return thisnewout inner conceptu instanc class outer contain special version inner class which instanti yield instanc outerinn refer os instanc variabl p object call enclos instanc outerinn object enclos instanc name explicitli qualifi thi express found java fji consist simpl name enclos class follow thi gener class refer enclos instanc c thi cngamma thi well usual thi also written cn thi fji object inner class instanti express form enewt ce e enclos instanc static type e result enewt ce alway instanc tc regardless runtim type e rigid reflect static natur java translat semant inner class explicit annot t use fji rememb static type e by contrast inner class beta virtual ie differ constructor may invok depend runtim type enclos instanc exampl subclass outer class outer also inner class inner onew inner might build instanc either outerinn outer inner depend dynam type o elabor process allow type name abbrevi java program exampl fji program written class outer extend object pair outerpair p super class inner extend object object sndp return psnd inner makeinn return new inner java here return type inner makeinn method denot nearest inner declara tion also java enclos instanc omit qualifi thi thu thisnewout inner origin exampl written new inner here subclass inner class almost form inherit involv inner class allow java toplevel class extend inner class anoth toplevel class inner class extend anoth inner class complet differ toplevel class inner class even extend enclos class onli one case disallow class cannot extend inner class discuss restrict later liber howev introduc signific complex method inherit superclass must execut lexic environ differ subclasss figur show situat three inner class aaa bbb ccc subclass hierarchi white oval repres enclos instanc three shade oval indic region program method ccc object may defin method inherit aaa execut environ consist enclos instanc athi athi may access member enclos class via athi athi similarli bbb ccc gener class n superclass inner n differ environ may access method moreov environ may consist one enclos instanc six enclos instanc requir method ccc work exampl abov forego see provid way six enclos instanc instanti ccc object recal that object inner class instanti enclos object provid prefix e new express exampl ccc object instanti write enewcc ce e enclos instanc correspond cthi enclos instanc come from first enclos instanc enclos class immedi enclos class cthi suppli new express explicitli reach via extend extend figur chain environ direct enclos instancefor exampl enclos instanc e enewcc ce form new ccnewc cd includ enclos instanc new cc correspond cthi second enclos instanc superclass determin constructor subclass take simpl exampl suppos extend inner class outerinn enclos instanc correspond outerthi requir make instanc subclass exampl subclass outerinn class refinedinn extend outerinn object c refinedinnerout thisouterinn object c declar refinedinn constructor ordinari argument thisouterinn becom enclos instanc prefix super constructor invoc provid valu outerthi refer inherit method sndp similarli ccc exampl subclass bbb written follow class b extend class b extend class b extend aaa object b bobject a aa thisaaa object b note that sinc enclos instanc correspond athi includ enclos instanc correspond athi b constructor take one extra argument enclos instanc class class c extend class c extend class c extend bbb object c cobject a aa thisaaa object b bb thisbbb object c sinc constructor superclass bbb initi athi constructor c initi bthi qualifi super invoc argument thisaaa pass super ordinari argument fji restrict qualif super constructor argument wherea java allow express qualif permit clean definit oper semant saw fj sinc state inform includ field enclos instanc object appear new express moreov technic reason connect name mangl involv translat semant requir constructor argument use qualif super name thisc direct superclass exampl abov lastli explain allow class extend one direct indirect inner class sensibl way make instanc class suppos could defin class below class foo extend foobar class bar sinc foo extend foobar constructor foo need instanc foo argument make imposs make instanc foo perhap one could use null enclos instanc case would use sinc inner class usual suppos make use enclos instanc syntax now proceed formal definit fji abstract syntax languag shown top left figur use notat convent previou section metavari s t u rang type qualifi class name a sequenc simpl name c c n concaten period compact definit introduc notat null qualif identifi c c metavari p rang type t write class declar l includ declar simpl name c superclass t field f constructor k inner class l method m two kind constructor declar depend whether superclass inner toplevel superclass inner subclass constructor must call super constructor qualif f provid enclos instanc visibl superclasss method see type rule constructor argument arrang follow order superclasss field initi superf or fsuperf enclos instanc superclass if need field class defin initi thisff like fj bodi method return express variabl field access method invoc object instanti assum set variabl includ special variabl cthi everi c variabl never use name argument method program pair class tabl ct a map type class declar l express e object treat special everi fji program definit object class appear class tabl auxiliari function look field method declar class tabl equip special case object return empti sequenc field empti set method lighten notat follow assum fix class tabl ct class tabl read subtyp relat class write subtyp tthe reflex transit closur immedi subclass relat given extend claus ct relat defin formal bottom left figur impos follow saniti condit class tabl ct class c everi inner class declar l name d ct object domct everi type except object appear anywher ct domct everi e newt ce and new ce resp appear anywher ct tc domct and c domct resp cycl subtyp relat tu two type tu condit class tabl fji identifi set toplevel class condit prohibit class extend one inner class syntax class c extend t f k l m e x new ce comput new cef gamma e cn new ce new cemd gamma ae x d cn in oe cn gamma ae x d cn in oe subtyp class c extend express type itfield method type in class cn extend mtypem itmethod class type ok pc l ok pc class c extend t f k l m ok p ok pc l ok pc class c extend td t f k l m ok p figur fji main definit field lookup class c extend t f k l m class c extend ud t f k l m class c extend s f k l m class c extend s f k l m defin method bodi lookup class c extend s f k l m class c extend s f k l m defin enclos instanc lookup encl tc class c extend s f encl new cd new class c extend ud s f encl new cd e class c extend s f encl new class c extend ud s f encl figur fji auxiliari definit auxiliari function type reduct rule need auxiliari definit given figur field class t written fieldst sequenc f pair class field name field declar class superclass addit fieldst collect type direct enclos instanc superclass t exampl fieldsccc return follow sequenc object a the field aaa enclos instanc bound athi object b the field bbb enclos instanc bound bthi object c the field ccc third rule definit insert enclos instanc inform field g superclass ud field f current class welltyp program fieldst alway agre constructor argument list t type method class t written mtypem t pair written ss sequenc argument type result type s similarli bodi method class t written mbodym t tripl written x e t sequenc paramet x express e class method defin function encl play crucial role semant fji intuit e toplevel inner class instanti encl return direct enclos instanc e visibl class ie enclos instanc provid correct lexic environ method inherit t first rule simplest case sinc type express e newt ce agre subscript tc return direct enclos instanc e rule follow common pattern explain fifth rule repres sinc subscript type differ type argument enclos instanc e correct answer therefor make recurs call object newu dd superclass obtain drop e mani argument e field f class sc keep go like until final argument becom instanc match first rule exampl encl aaa enewcc ca new anewa a b new bnewb b c new bnewb bnewbb ba new anewa a b new anewa anewaa aa new anewa a note encl function output direct enclos instanc obtain outer enclos instanc athi encl use repeatedli encl aa encl aaa e comput fj reduct relat fji form e gamma e write gamma reflex transit closur gamma reduct rule given middl left column figur four reduct rule two field access two method invoc field access express new cef look field name f c use fieldsc yield constructor argument e posit correspond f field list enewt cef behav similarli method invoc express new cemd first call mbodym c obtain tripl sequenc formal argument x method bodi e class c delta delta delta cn defin yield substitut instanc method bodi x replac actual argument d special variabl cnthi receiv object new ce c thi for n correspond enclos instanc c obtain encl sinc method invok defin c delta delta delta cn direct enclos instanc thi obtain encl c deltadeltadeltac n e e receiv object similarli cngamma thi obtain encl c deltadeltadeltac encl c deltadeltadeltac n e on reduct rule may appli point express also need obviou congruenc rule if e gamma e f like omit here exampl class tabl includ outer refinedinn pair a b new refinedinnernew outernew pairnew a new b new objectsndp reduc new b follow new refinedinnernew outernew pairnew a new b new objectsndp gamma new outernew pairnew a new bpsnd gamma new pairnew a new bsnd gamma new b underlin subexpress redic reduct step type rule type rule express method declar class declar given righthand column figur environ gamma finit map variabl type written xt type judgment express form gamma e t read in environ gamma express e type t type rule syntax direct one rule form express type rule object instanti method invoc check actual paramet type subtyp correspond formal paramet type obtain field mtype enclos object must type subtyp annot type new t type judgment method declar form ok c delta delta delta cn read method declar ok declar class c delta delta delta cn bodi method type context formal paramet method declar type c thi type c delta delta delta c method name declar superclass must type subclass type judgment class declar form l ok p read class declar l ok declar p p type t class declar l inner class otherwis l toplevel class type rule check constructor appli super field superclass initi field declar class method declar inner class declar class ok condit c p ensur simpl class name defin also simpl name one enclos class avoid ambigu mean cthi properti easi show fji program enjoy standard subject reduct progress properti togeth guarante welltyp program never caus nosuchfielderror nosuchmethoderror theorem subject reduct gamma e e gamma e proof sketch main properti requir proof follow termsubstitut lemma prove induct deriv gamma plu follow lemma similarli e theorem prove induct deriv e gamma e case analysi last rule use case irinvkt irinvki easi use lemma abov base case also straightforward induct step xi theorem progress suppos e welltyp express e includ new c ef subexpress fieldsc similarli e includ e includ new c emd subexpress mbodym c similarli e includ e translat semant section consid style semant translat fji fj everi inner class compil toplevel class one addit field hold refer direct enclos in stanc occurr qualifi translat access field exampl outer refinedinn class previou section compil follow three fj class class outer extend object pair outerinn makeinn return new outerinnerthi class outerinn extend object outer outerinnerout thisouterinn object sndp return thisthisouterinnerpsnd class refinedinn extend outerinn object c refinedinnerout thisouterinn object c inner class outerinn compil toplevel class outerinn field thisouterinn hold outer object correspond direct enclos instanc outerthi origin fji program thu outerthi compil field access express thisthisouterinn give compil function j delta j syntact categori except type compil function take second argument fji class name or entiti translat defin written or type express method everi qualifi class name translat simpl name obtain syntact replac compil express written jej given below write jej shorthand je and similarli jnew dej new d jej new jtdj jej saw abov compil inner class one addit field call thi jtj origin class name c thi class c delta delta delta cn becom express follow refer direct enclos instanc sequenc reach correct one enclos instanc e e newt ce becom last argument compil constructor invoc compil method written jmj straightforward stand jt constructor class compil constructor written jkj given below four case depend whether current class toplevel class inner class whether superclass toplevel class inner class current class inner class one argument correspond enclos instanc ad argument list name constructor becom jtcj translat qualifi name class superclass inner argument use qualif fsuperf becom last argument super invoc final compil class written jlj p follow class c extend t f k l m class c extend jsj class c extend t f k l m class jtcj extend jsj constructor inner class method class c defin p compil auxiliari argument pc inner class l becom toplevel class constructor compil compil class inner name chang jtcj field thi jtcj hold enclos instanc ad compil class tabl written jct j achiev compil toplevel class l ct ie properti translat semant easi show translat semant preserv type sens welltyp fji program compil welltyp fj program theorem compil preserv type ct ok respect ct respect jct j jct j ok final come main result section correspond direct semant present previou section translat semant defin here show behavior compil program exactli reflect behavior origin program fji everi step reduct welltyp fji program compil program take one step reach correspond state theorem compil commut reduct gamma fji e egamma fji e gamma fj proof straightforward induct deriv e gamma fji e case analysi last rule use main lemma case irinvkt irinvki is suppos jnew cej new cej similarli lemma show calcul encl e correctli mimick field access mangl field translat sinc method invoc direct semant may involv calcul encl delta delta delta sever time lowlevel reduct may requir one step mimic one step fji level xi conclus futur work formal two style semant inner class direct style translat style semant given compil lowlevel languag without inner class follow java inner class specif prove two style correspond sens translat commut highlevel reduct relat direct semant besid deepen understand inner class work uncov sever bug variou java compil futur work interact inner class access restrict java clearli worth investig also hope abl model java form inner class anonym class local class declar method bodi slightli complic sinc method argument not field occur free variabl expect captur variant fji acknowledg work support univers pennsylvania nation scienc foundat grant ccr principl foundat program object igarashi research fellow japan societi promot scienc would like thank bug parad java develop connect httpdeveloperjavasuncomdeveloperbugparadeindexhtml provid use inform r secur implement java inner class make futur safe past ad gener java program languag featherweight java minim core calculu java gj inner class birger mllerpedersen tr smalltalk languag implement virtual class power mechan objectori program javaisublightsubi typesafemyampersandmdashdefinit class mixin make futur safe past java type system sound semant analysi virtual class test class featherwieght java c program languag third edit java languag specif static safe altern virtual type protect programminglanguag translat ctr nathaniel nystrom stephen chong andrew c myer scalabl extens via nest inherit acm sigplan notic v n octob d ancona c anderson f damiani s drossopoul p giannini e zucca provenli correct translat fickl java acm transact program languag system topla v n pe april christoph leagu zhong shao valeri trifonov typepreserv compil featherweight java acm transact program languag system topla v n p march radha jagadeesan alan jeffrey jame rieli type parametr polymorph aspect scienc comput program v n p decemb