t effici comput spars jacobian matric use automat differenti a paper concern effici comput spars jacobian matric nonlinear vector map use automat differenti ad specif propos use graph color techniqu bicolor exploit sparsiti jacobian matrix j therebi allow effici determin j use ad softwar analyz direct scheme substitut process discuss result numer experi indic signific practic potenti approach b introduct effici numer solut nonlinear system algebra equat f usual requir repeat calcul estim matrix first deriv jacobian largescal problem matrix j often spars import exploit fact order effici determin estim matrix j given argument x paper concern effici calcul spars jacobian matric judici applic automat differenti techniqu specif show defin thin matric v w nonzero element j easili extract calcul pair w j jv research partial support appli mathemat scienc research program kc offic energi research us depart energi grant defger part advanc comput research institut unit cornel theori center receiv major fund nation scienc foundat ibm corpor addit support new york state member corpor research institut technic report also appear cornel comput scienc technic report tr comput scienc depart center appli mathemat cornel univers ithaca ny z comput scienc depart cornel univers ithaca ny given arbitrari nbyt v matrix v product jv directli calcul use automat differenti forward mode given arbitrari mbyt w matrix w product w j calcul use automat differenti revers mode eg forward mode automat differenti allow comput product jv time proport v delta f f time requir evalu f fact lead follow practic question given structur spars jacobian matrix j matrix v chosen nonzero j easili determin product jv good solut offer spars finitedifferenc literatur adapt automat differenti set partit column j set group gc number group gc denot jgc j column group g gc structur orthogon group g gc defin column v column group g otherwis v clear nonzero j immedi identifi comput product jv graph color techniqu appli column intersect graph j use tri produc partit gc low cardin jgc j thi turn induc thin matrix v ie construct howev alway possibl ensur jgc j small consid spars matrix j singl dens row altern revers mode automat differenti allow comput product w j time proport w delta f f time requir evalu f transpos argument lead effici way determin j is appli graph color techniqu row intersect graph j induc thin matrix via revers mode automat differenti take time proport trivial extract nonzero j comput matrix w j cours easi construct exampl defin thin matrix w possibl consid case j dens column clearli problem rowori approach prefer problem columnori approach better unfortun easi devis problem neither approach satisfactori let j dens row dens column exactli may pay use mode automat differenti simultan comput pair choic w v extract nonzero element j comput pair thin matric concern paper effici respect number float point oper f lop concern space requir studi howev note revers mode automat differenti often requir significantli space forward mode space tight suggest approach involv applic forward revers mode may possibl current research activ reduc space requir revers mode automat differenti eg note independ propos regard spars jacobian calcul made hossain steihaug graphtheoret interpret direct determin problem given algorithm base interpret provid paper proffer new direct method also propos substitut method base directli jacobian structur compar direct substitut method numer discuss roundoff properti substitut method addit interfac graph color softwar automat differenti adolc report preliminari comput result remaind paper organ follow x review relev aspect two nonzero nvector v w structur orthogon v w automat differenti forward revers mode x formal combinatori problem solv matrix point view term graph theori propos direct determin problem substitut problem x propos bicolor approach direct determin determin substitut problem bicolor techniqu produc matric v w jv subsequ determin via forward mode automat differenti w j detemin via revers mode typic column dimens v w small cost applic automat differenti proport sum column dimens v w time work evalu f x present discuss variou numer experi experi indic bicolor approach significantli reduc cost determin j over onesid jacobian determin substitut method propos consist outperform direct method howev substitut calcul increas chanc roundoff contamin effect discuss x end paper x conclud remark observ possibl direct futur research specif note sparsiti symptom underli structur nonlinear problem necessari symptom moreov often possibl exploit structur absenc sparsiti appli ad tool surgic effici obtain jacobian matrix j sectionbas automat differenti automat differenti chain rule base techniqu evalu deriv analyt and henc without truncat error respect input variabl function defin highlevel languag comput program section briefli review basic automat differenti borrow heavili program comput function view sequenc scalar assign v vector v thought set order variabl v comput v j use set variabl fv k jk ig j repres elementari function arithmet oper andor univari transcedent function order variabl abov partit variabl v j three vector gener number intermedi variabl much larger dimens problem assum elementari function well defin continu elementari assum loss gener depend variabl occur argument elementari function combin partial c ij p m theta n p matrix c nij ipm unless elementari function two argument includ librari row c contain either one two non zero entri defin number also sinc work involv elementari function proport number argument follow proportion order relat squar matrix c upper trapezoid nontrivi superdiagon thu c partit l l strictli lower triangular applic chain rule yield deltax deltay elimin intermedi vector deltay get expressionth schur complement jacobian unit lower triangular matrix calcul matrix product lead two natur way comput j altern express j given defin two basic mode automat differenti ation forward revers forward mode correspond comput row a one one correspond row a obtain success evalu elementari function sinc amount solut n linear system lowertriangular matrix i gamma l follow multipl dens column total comput effort roughli n delta q n delta f revers mode correspond comput solut linear system backsubstitut process begin elementari function partial deriv evalu sinc amount solut linear system lower triangular matrix i gamma l follow multipl dens row a total comput effort roughli delta q delta f interest comput product form jv w j product jv comput clearli done time proport v nthetat v analag product comput done time proport w delta f assum import subcas worthi special attent f scalar function ie case jacobian matrix correspond transpos gradient f singl row vector note complex argument appli case impli revers mode ad yield gradient time proport f wherea forward mode cost n delta f effici forward mode evalu gradient dramat increas ie depend n remov f structur exploit partit problem graph theori basic task effici determin thin matric v w nonzero element j readili extract inform w j jv pair matric w j jv obtain applic mode automat differenti matrix w j comput revers mode forward mode determin jv purpos section rigor formul question determin suitabl matric v w first languag partit use graph theoret concept begin exampl illustr use simultan appli mode ad forward revers consid follow nbyn jacobian symmetr structur valu clear partit column consist direct determin j requir n group consist column partit requir group contain column structur orthogon presenc dens row impli group consist exactli one column therefor matrix v correspond consist column partit v n column work evalu jv forward mode ad proport n delta f similar argument fact column j dens consist row partit requir n group therefor matrix w correspond consist row partit w row work evalu w j revers mode ad proport n delta f definit bipartit matrix pair gr gc gr row partit subset row gc column partit subset column a exampl use bipartit dramat decreas amount work requir determin j specif total amount work requir proport delta f see usual convent repres th column ident matrix e clearli element directli determin product jv element directli determin product w j basic idea partit row set group gr column set group gc small possibl everi nonzero element j directli determin either group gr group gc definit bipartit gr gc matrix consist direct determin everi nonzero ij a either column j group gc column nonzero row i row group gr row nonzero column j clearli given bipartit gr gc consist direct determin trivial construct matric nthetajg c j directli determin relax restrict nonzero element j determin directli possibl work requir evalu nonzero j reduc exampl could allow substitut process recov nonzero j pair figur illustr substitut method win direct determin figur correspond direct determin figur correspond determin use figur optim partit direct method case element label comput column group ie calcul use product jv element label calcul form row group ie calcul use product w j matrix figur indic choos gc jgc gr jgr determin element directli is choos choos therefor case work comput j satisfi j delta f note element determin twice eg j howev matrix figur show obtain nonzero j use substitut work proport delta f let forward comput figur optim partit substitut method vector revers comput row vector p nonzero element determin directli no conflict remain element resolv easi extend exampl differ number group need substitut direct determin increas dimens matrix exampl block gener illustr figur assum l w straightforward verifi optim partit number group need direct determin w determin substitut requir w group definit bipartit gr gc matrix consist determin substitut exist order element ij everi nonzero ij a either column j group nonzero row i column group order lower ij row group nonzero column j row group order lower ij usual way construct matrix v column group gc matrix w row group gr exampl construct column v associ group l l figur block exampl gc boolean vector unit entri indic membership correspond column state main problem precis bipartit problem direct given matrix a obtain bipartit gr gc consist direct determin total number group minim bipartit problem substitut given matrix a obtain bipartit gr gc consist determin substitut total number group jgc j minim bipartit problem also express term graph graph color graph view import readili expos relationship bipartit problem combinatori approach use spars finitedifferenc literatur eg howev note remaind paper except error analysi x reli directli graph interpret begin need usual notion color vertic graph definit bipartit graph concept path color special bipartit graph case pcolor graph set vertic node e set edg function oeu oev u v e chromat number g smallest p g pcolor pcolor oe g induc partit vertic given matrix mthetan defin bipartit graph e correspond jth column a r correspond ith row a edg r nonzero a path pcolor graph defin vertex color use p color addit properti everi path least edg use least color need slight modif concept appropri direct determin problem note color distinguish correspond lack true color assign ie indic vertex assign color definit let g e bipartit graph map oe bipartit path pcolor g b adjac vertic differ assign ie i set posit color use vertic v disjoint set posit color use vertic g vertic j adjac vertex k everi path edg use least least color smallest number graph g b bipartit path pcolor denot figur show valid bipartit path pcolor number adjac vertic denot color note hossain steihaug defin similar concept howev definit path pcolor allow uncolor assign ie consequ techniqu remov empti group need posit state graph analog concept bipartit consist direct determin theorem let theta n matrix correspond bipartit graph e map induc bipartit gr gc consist direct determin oe bipartit path pcolor g b a proof assum oe bipartit path pcolor g b a induc bipartit gr gc row column a bipartit consist direct determin nonzero element ij matrix definit either column j group gc column nonzero row i row group gr row nonzero column j hold happen one follow case hold exist column q iq oec j contradict condit exist row p pj oer contradict condit column row figur valid bipartit path color exist column q row p column j q group iq row p group pj impli oe color path r contradict condit convers assum oe induc bipartit consist direct determin a clear condit gamma must satisfi remain us establish condit ie everi path edg use least color suppos bicolor condit two color path posit easi see element jk cannot determin directli conflict row group conflict column group oec k two chanc determin jk captur substitut notion cyclic pcolor definit modifi slightli appli bipartit graph definit let theta n matrix correspond bipartit graph e map oe bipartit cyclic pcolor g b adjac vertic differ assign ie i set posit color use vertic v disjoint set posit color use vertic g vertic j adjac vertex k everi cycl use least least color smallest number graph g b bipartit cyclic pcolor denot c g b figur show valid bipartit cyclic pcolor note color necessari wherea bipartit path pcolor figur requir color notion bipartit consistentcolumn figur valid bipartit cyclic color determin via substitut cleanli start graphtheoret term theorem let theta n matrix correspond bipartit graph e map oe induc bipartit gr gc consist determin substitut oe bipartit cyclic pcolor g b a proof assum oe induc bipartit consist determin substitut oe bipartit cyclic pcolor g b a clearli condit must hold easi see condit hold nonzero element determin nontrivi violat condit cycl two color ie vertic cycl color c vertic cycl color c note neither c c equal sinc node color cycl would impli adjac vertic color differ impli least color consid submatrix a correspond cycl submatrix least two non zero row column sinc vertex degre cycl sinc consid substitut method onli least one element need comput directli clearli way get element submatrix directli contradict convers assum oe bipartit cyclic pcolor g b a bipartit induc oe consist determin substitut but edg nonzero one end assign color determin directli definit bicolor conflict moreov everi pair posit color induc forest ie collect tree therefor edg nonzero induc forest resolv via substitut two bipartit problem simpli state term optim bipartit path cyclic pcolor bipartit path pcolor problem determin bipartit path pcolor g b a smallest possibl valu p ie bipartit cyclic pcolor problem determin bipartit cyclic pcolor g b a smallest possibl valu p ie graph theoret view use analyz complex combinatori problem suggest possibl algorithm exact heurist fact use pcolor notion discuss abov approach similar taken easi show correspond decis problem npcomplet bipartit cyclic pcolor decis problem ccdp given integ p arbitrari bipartit graph g possibl assign cyclic pcolor node g bipartit path pcolor decis problem pcdp given integ p arbitrari bipartit graph g possibl assign bipartit path pcolor node g proof straightforward adapt omit here upshot neg complex result practis must turn attent fast heurist approxim solv cyclic path color problem next section present simpl effect easytovisu heurist two combinatori problem final easi establish partial order chromat number gm refer column intersect graph matrix gm usual chromat number graph gm first inequ hold oe bipartit path pcolor oe bipartit cyclic pcolor second inequ hold trivial way satisfi condit gamma definit assign row column node use posit color column row node satisfi condit order support tenet use bi partitionbicolor never wors onesid calcul substitut approach never wors direct approach in principl bicolor two combinatori problem face correspond direct determin determin substitut approach follow way first permut partit structur j indic figur construct partit crucial howev postpon discuss illustr it util assum r r figur possibl partit matrix second defin appropri intersect graph g r base partit j c jj r color g c yield partit subset column gc defin matrix v matrix w defin partit subset row gr given color g r call doubl color approach bicolor differ direct substitut case intersect graph g r defin nonzero j extract pair w j jv direct determin direct case intersect graph g c defin g k j kr j ks either k r jc key point construct graph g c g c distinguish usual column intersect graph column r said intersect nonzero locat overlap part jc ie column r intersect j kr delta j ks either transpos procedur use defin g r specif g r nnzrow matrix vector nnzm number nonzero case reason graph g r distinguish usual row intersect graph row r said intersect nonzero locat overlap part jr row r intersect j rk delta j bipartit gr gc induc color graph g r g c consist direct determin j see consid nonzero element i group gc correspond color properti column gc nonzero row i henc element i j directli determin analag consid nonzero element row r group gr correspond color properti row gr nonzero column s henc element r s directli determin sinc everi nonzero j cover result follow exampl consid exampl jacobian matrix structur shown figur partit figur exampl partit graph gc gr form algorithm outlin given figur color gc requir color gr color two boolean matric v w form usual way column correspond group or color unit entri indic column or row membership group theta j theta j j j clearli nonzero entri j identifi either jv w j c c r r r figur graph gc gr direct approach determin substitut basic advantag determin substitut conjunct partit sparser intersect graph g r use sparser intersect graph mean thinner matric v w which turn result reduc cost substitut case intersect graph g c defin g k j kr j ks k r jc k s jc note intersect graph g captur notion two column intersect overlap nonzero structur jc column r intersect j kr delta j ks k easi see e c subset set edg use direct determin case transpos procedur use defin g r specif g r row jr nnzrow intersect graph g r captur notion two row intersect overlap nonzero structur jr row r intersect j rk delta j k easi see e r subset set edg use direct determin element j determin w j jv substitut process evid illustr figur figur illustr two four possibl nontriv type partit case clear nonzero element section label solv directli construct process differ group nonzero element either determin directli depend element section element section alreadi determin directli so substitut element determin element section determin depend element entir matrix resolv jr figur substitut order exampl consid exampl jacobian matrix structur shown figur column row intersect graph correspond substitut given figur note gc disconnect requir color gr simpl chain also requir color c c r r r figur graph gc gr substitut process color gc gr lead follow matric v w result comput jv w theta theta j theta j j j easi verifi nonzero j determin via substitut partit j consid problem obtain use partit j c jj r correspond permut matric p q illustr figur simpl heurist propos base knowledg subsequ step direct substitut method color intersect graph base partit algorithm mnco build partit jc bottom up partit jr right left k th major iter either new row ad jc new column ad jr choic depend consid lower bound effect aej r aea maximum number nonzero row matrix a r row consider ad jc c column consider ad jr henc number color need color g c bound aej c number color need color g r bound aej algorithm mnco matrix c submatrix j defin row indic r column indic c consist row column j yet assign either jc jr minimum nonzero count order mnco initi find r r fewest nonzero find c c fewest nonzero repeat aej rrfrg els ccfcg repeat note that upon complet jr jc defin requisit permut matric implicitli defin order chosen mnco bicolor perform section present result numer experi work requir comput spars jacobian matrix work need comput w j jv which turn proport work evalu function f time sum column dimens boolean matric column dimens sum equal number color use bicolor experi compar comput color number requir direct substitut approach also comput number color requir onesid scheme column partit alon correspond construct v base color column intersect graph j row partit alon correspond construct w base color row intersect graph j latter case lead applic revers mode ad alon wherea former case lead use forward mode direct substitut method requir color respect pair intersect graph g r mani effici graph color heurist avail experi use incid degre id order use three sourc test matric linear program testb result report tabl summar tabl harwellbo spars matrix collect result report tabl selfgener mbyn grid matric result given tabl grid matrix construct follow way first approxim n column chosen space uniformli chosen column randomli assign den delta nonzero second approxim p row chosen space uniformli chosen row randomli assign nonzero vari den record tabl problem cite dimens matrix number nonzerosnnz experiment result report number color requir bicolor approach direct substitut number color requir onesid scheme bicolor onesid name n nnz direct substitut column row standata stair blend vtpbase agg agg agg bore israel adlittl tabl lp constraint matric httpwwwnetliborglpdata tabl total lp collect bicolor side color name n nnz direct substitut column row cann cann cann cann cann cann cann chemimpimpcolc chemimpimpcold chemimpimpcol chemwestwest chemwestwest chemwestwest tabl harwellbo collect ftp orioncerfacsfr observ first observ bicolor approach often signific win onesid determi nation occasion improv spectacular eg cann improv harwellbo problem gener signific lp collect sens bicolor significantli outperform onesid possibl partial due fact matric lp collect rectangular wherea matric harwellbo collect squar calcul nonzero j w j alon quit attract j rel row grid collect display advantag bicolor great effect grid matric ideal bicolor candid gener advantag substitut direct determin great differ bicolor onesid determin nevertheless fewer color almost alway need expens function f import problem gain though approach eg watt tabl total harwellbo collect bicolor side color n den direct substitut column row tabl grid matric interfac adolc interfac color substitut routin adolc softwar c packag adolc facilit evalu first higher order deriv vector func tion defin program written c c compar time need sampl problem respect five approach ffl adbicolor direct ffl adbicolor substitut ffl adcolumn color forward mode ffl adrow color revers mode ffl fd spars finit differenc base column color test function f use simpl nonlinear function defin index set nonzero row jacobian matrix defin f tabl total grid matric jacobian matrix and thu sparsiti pattern by block version figur ie problem dimens indic figur use experi result portray figur suggest follow order execut time requir differ techniqu note fd requir time adcolumn even though color use both work estim v delta f actual upper bound work requir forward mode v number column v bound often loos practis finitedifferenc sinc subroutin evalu f actual call time problem size time in second perform graph differ spars approach ad column ad row fd adbicoloringdirect adbicoloringsubstitut figur comparison differ spars techniqu anoth interest observ revers mode calcul adrow twice expens forward calcul adcolumn noteworthi exampl base structur figur column dimens v w equal suggest may practic weigh cost forward calclul jv versu calcul w j w v vector comment aspect x substitut roundoff gener substitut approach requir fewer color therefor effici principl direct determin howev possibl increas roundoff error due substitut process fact analog issu aris spars hessian approxim context where indee consider caus concern purpos section examin question ad context bottom line less worri case spars hessian approxim case signific error growth occur finitediffer step size vari set finitediffer direct howev current set issu sinc step size equal uniti case first consid number substitut requir determin nonzero j chosen use substitut stategi good news similar spars hessian approxim situat number depend substitut resolv nonzero j bound bm theorem let oe bipartit cyclic pcolor g b j then oe correspond substitut determin j unknown j depend mn gamma unknown moreov possibl order calcul maximum number substitut less equal first edg nonzero one end assign color determin directli definit bicolor conflict second everi pair posit color induc forest ie collect tree g b j therefor edg nonzero induc forest resolv via substitut henc edg nonzero resolv either directli substitut process worst case correspond tree yield upper bound mn gamma substitut howev easi see substitut calcul order halv worstcas bound yield substitut next develop express bound error comput jacobian except element resolv directli nonzero element jacobian matrix solv consid subgraph induc posit color direct one color correspond subset row one color correspond subset column let us look subgraph g pq induc color p column q row let z q j r q set row color q c p set column color p let denot quantiti comput via ad note error introduc due automat differenti process typic small solut process element j ij determin z cours substitut method incur extra cost perform substitut calcul howev done effici subsequ cost usual neglig depend whether column equat of form jv row equat of form w j use here nr denot set neighbour row g pq nc j denot set neighbour column j g pq assum j actual denot actual jacobian matrix henc j actual j actual j actual j actual defin error matrix ij differ z depend way element j ij comput take account effect round error let ij equal ffl ij plu contribut round error due use equat determin j ij again depend way j ij calcul moreov let ffl max constant note ffl max contribut step size unlik result finit differenc theorem j obtain substitut process proof equat let us assum without loss gener equat hold impli bound decomposit appli recurs e ik use theorem result follow two posit aspect theorem first unlik spars finitediffer substitut method hessian matric depend variabl step size ad step size effect uniformli equal uniti second cumul depend nnzj rather matrix dimens m n howev one unsatisfactori aspect bound theorem bound express term ffl max ffl max known restrict magnitud similar situat aris nevertheless illustr exampl discuss below ffl max usual modest practis conclud section small experi inspect final accuraci comput jacobian matric test function f simpl nonlinear function describ x tabl fd spars finit differ comput use fix stepsiz fd refer spars finit differ comput use variabl stepsiz ff uniformli vari rang ffl column label rel error record kerrk nonzero err correspond nonzero j comput j actual gener trend observ follow first similar result report forwardmod direct determin jacobian matric determin bicoloringad approach significantli uniformli accur finitediffer approxim true direct determin substitut approach second direct approach uniformli accur substitut method howev jacobian matric determin via substitut suffici accur purpos achiev least digit accuraci usual more final problem rel littl differ accuraci fix step method variabl step method howev illustr easi construct exampl variabl step approach produc unaccept accuraci direct substitut fd fd size rel error rel error rel error rel error tabl error sampl nonlinear problem conclud remark propos effect way comput spars jacobian matrix j use automat differenti propos use new graph techniqu bicolor divid differenti work two mode automat differenti forward revers forward mode comput product jv given matrix v revers mode comput product w j given matrix w suggest way choos thin matric v w work comput pair w j jv modest nonzero element j readili extract numer result strongli support view bicoloringad superior onesid comput both ad fd respect order work requir cours ad approach offer addit advantag fd scheme significantli better accuraci need heurist determin step size rule sparsiti pattern need determin priori implicit approach assumpt cost comput jv forward mode ad equal cost comput w j revers mode ad v w vector true order magnitud sens comput take time proport f respect constant may differ wide may pragmat estim weight w respect given ad tool reflect rel cost forward revers mode easi introduc weight algorithm mnco x heurist solv weight problem number row group or color assign row number column group or color assign column heurist mnco chang address problem simpli chang condit lb to r differ weight produc differ alloc work forward revers mode skew reflect rel cost exampl consid by grid matrix x let us vari rel weight forward versu revers mode w result weight bicolor approach given tabl tabl weight problem result final note bicolor idea sometim use effici determin rel dens jacobian matric provid structur inform known function f exampl suppos partial separ function t compon function f typic depend compon x clearli jacobian function j spars summat may may spars depend sparsiti pattern howev defin stack function f jacobian f j spars bicoloringad techniqu appli j possibl yield dramat decreas cost specif j dens a possibl work comput j without exploit structur n delta f wherea cost comput j via bicoloringad approxim j minimum number color requir bipartit cyclic color graph g b j typic c g b n idea appli bicoloringad techniqu structur way restrict partial separ function acknowledg grate andrea griewank student jean utk colleagu david jued help us use adolc r new method color vertic graph cyclic color problem estim spars hessian matric structur effici jacobian calcul estim spars jacobian matric direct calcul newton step without accumul jacobian comput spars jacobian matrix row column estim spars hessian matric tr ctr shahadat hossain trond steihaug sparsiti issu comput jacobian matric proceed intern symposium symbol algebra comput p juli lill franc dominiqu villard michael b monagan adrien implement automat differenti mapl proceed intern symposium symbol algebra comput p juli vancouv british columbia canada l f shampin robert ketzscher shaun a forth use ad solv bvp matlab acm transact mathemat softwar tom v n p march shaun a forth effici overload implement forward mode automat differenti matlab acm transact mathemat softwar tom v n p june thoma f coleman arun verma admit automat differenti matlab interfac toolbox acm transact mathemat softwar tom v n p march