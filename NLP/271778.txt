t construct compact model concurr java program a finitest verif technolog eg model check provid power mean detect concurr error often subtl difficult reproduc nevertheless widespread use technolog develop unlik tool provid autom support extract requir finitest model directli program sourc paper explor extract compact concurr model java code particular show static pointer analysi tradit use comput alia inform optim use greatli reduc size finitest model concurr java program b introduct finitest analysi tool eg model checker automat detect concurr error often subtl difficult reproduc tool appli softwar finitest model program must construct model must accur enough verifi requir yet abstract enough make analysi tractabl paper consid problem construct model concurr java program consid java becaus explos internet applic java stand becom domin languag write concurr softwar new gener programm write concurr applic first time encount subtl concurr error heretofor plagu mostli oper system telephoni switch develop java use monitorlik mechan thread synchron that simpl describ difficult use correctli a colleagu teach concurr copyright c fl associ comput machineri inc permiss make digit hard copi part work person classroom use grant without fee provid copi made distribut profit direct commerci advantag copi bear notic full citat first page copyright compon work own other acm must honor abstract credit permit copi otherwis republish post server redistribut list requir prior specif permiss andor fee java program found half student wrote program nest monitor deadlock ideal analysi tool could extract model program use model verifi properti program eg freedom deadlock practic extract concurr model difficult autom complet order obtain model small enough tractabl analysi analyst must assist exist tool specifi aspect program model particular represent certain variabl often necessari make model suffici accur variabl must often abstract restrict make analysi tractabl although model restrict rang variabl repres possibl behavior program thu cannot technic use verifi program properti convent wisdom concurr error present small version system thu model still use find error test previou work concurr analysi softwar use ada although aspect method also appli java program java languag present sever new chal lengesopportun due objectori style typic java pro gram variabl need repres field heap alloc object stack static alloc variabl common ada java thread must creat dynam thu imposs in gener determin mani thread program creat although ada task may creat dynam mani concurr ada program contain static alloc task java lock mechan synchron access share data exploit reduc size model main contribut paper show static pointer analysi use reduc size finitest model concurr java program method employ virtual coarsen wellknown techniqu reduc size concurr model collaps invis action eg updat variabl local protect lock adjac visibl action static pointer analysi use construct approxim runtim structur heap statement inform use identifi heap object actual local thread lock guard access variabl paper organ follow first provid brief overview java concurr featur section section defin formal model transit system section explain size model reduc virtual coarsen given certain inform runtim heap structur avail explain collect inform use static pointer analysi section section show use heap structur inform appli reduct final section conclud concurr java java essenti concurr featur illustr familiar bound buffer system shown figur java thread instanc class thread or subclass thereof creat use alloc ie new constructor thread take paramet object implement interfac runnabl essenti mean object method run thread start call start method thread execut run method object although thread may assign prioriti control schedul paper assum model thread equal prioriti schedul ar captur possibl execut exampl program begin execut static method main main thread creat instanc intbuff creat instanc produc consum point intbuff creat instanc thread point produc consum start thread execut run method produc consum produc consum thread putget integ share buffer two type synchron bound buffer problem first access buffer mutual exclus everi java object implicit lock thread execut synchron statement must acquir lock object name express execut bodi statement releas lock bodi exit lock unavail thread block lock releas acquir lock current object thi method bodi common idiom may abbrevi simpli place keyword synchron method signatur second type synchron involv wait caller put must wait space buffer caller get must wait buffer nonempti entri precondit oper check and fals thread block object execut wait method releas lock method chang state object way precondit might true execut notifyal method wake thread wait object these thread must reacquir object lock return wait formal model model concurr java program finitest transit system state transit system abstract state java program transit repres execut code transform abstract state formal transit system pair s heap structur thread thread consum produc intbuff int data buf buf public class intbuff protect int data protect int count protect int public intbufferint capac new intcapac alloc array datalength size array capac public void putint x synchron thi count datalength buffer full datafront count buffer empti public int get synchron thi count wait wait buffer empti int count datalength notifyal buffer full return x public class produc implement runnabl protect int next next int produc protect intbuff buf public void run true public class consum implement runnabl protect intbuff buf public void run true int public class main public static void mainstr arg new new threadnew producerbufstart new threadnew consumerbufstart figur bound buffer exampl transform state variabl loc loc locat thread lock state lock free taken x valu program variabl x initi thread lock unlock thread lock state space fragment state loc loc lock x figur exampl transit system dn set state state assign valu finit set state variabl rang finit domain transit relat defin set guard transform state variabl call guard boolean predic state s call transform map state state g s true sometim write trace transit system sequenc transit s method construct transit system repres java program similar method present construct untim transit system repres ada program state variabl use record current control locat thread valu key program variabl runtim inform necessari implement concurr semant eg whether thread readi run block object transform repres execut bytecod instruct thread depthfirst search state space use enumer reachabl state anal ysi state successor gener readi thread repres thread execut small exampl figur give flavor translat java heap must also repres bound number state model limit number instanc class includ thread may exist simultan paper assum limit provid analyst class c instanc limit kc program attempt alloc instanc class c point kc instanc still access java use garbag collect transit system goe special trap stateth model repres behavior program beyond point discuss introduc tion restrict model still use find error consid bound buffer exampl figur could gener restrict model program repres variabl restrict rang restrict variabl repres content buffer f g variabl repres size buffer f g would obtain restrict interest model program ie one would like contain concurr error reduct transit system s produc method sketch section much larger requir analys often larg construct instead construct reduc transit system s use analysi reduc size transit system use virtual coarsen wellknown techniqu reduc size concurr model amalgam transit sinc use interleav model concurr reduc number transit thread greatli reduc number possibl state elimin interleav collaps transit sequenc reduc transit system construct classifi transform defin visibl invis compos maxim sequenc invis transform given thread visibl transform follow sequenc transit state gener compos transform form s exampl figur might replac transform singl transform ffi updat x releas lock could elimin control locat domain loc assum requir verifi test specifi stutteringinvari formula f linear tempor logic ltl atom proposit state variabl statement true state transit system s use reduc transit system should equival origin transit system purpos verif specif construct directli program without first construct s note reduc model construct specif thu reduct must repeat properti verifi classifi transform invis compos successor transform show cannot chang truth valu f construct appli tempor oper state predic boolean combin atom propo sition let pm state predic f fobserv state denot pf s vector boolean give valu s transform fobserv chang fobserv trace s defin sequenc f observ reduc combin consecut ident ie stutter fobserv easi show set reduc fobserv sequenc determin truth valu f therefor satisfi condit abov construct reduc transit system set reduc fobserv sequenc origin transit system satisfi condit must without construct s must classifi transform vi ibleinvis base inform obtain program code below give two case transform repres java code made invis case need inform structur heap runtim appli reduct show collect inform section local variabl reduct state variabl access particular thread run exampl program variabl local scope particular thread languag seman tic also state variabl record control locat thread access thread transform access exclus state variabl may made invis provid fobserv understand whi consid transform figur assum fobserv access variabl local thread whose code repres let repres code thread execut immedi follow code repres t replac ffi if multipl successor t say replac prove reduct chang truth valu f must show result transit system set reduc fobserv sequenc origin transit system state enabl may one sequenc transform repres execut code thread ie thread t combin elimin trace occur elimin reduc fobserv sequenc howev sinc execut must produc reduc f observ sequenc execut access variabl independ commut state enabl fobserv trace obtain execut t must reduc fobserv sequenc trace obtain execut use techniqu would like determin variabl local particular java thread ie referenc thread program variabl local thread if variabl stack alloc ie declar method bodi formal paramet variabl static alloc referenc one thread variabl heap alloc ie instanc variabl object object access one thread exampl variabl next class reduct reduct figur reduc combin produc figur access produc thread case trivial detect case difficult due dynam natur thread creation though follow conserv approxim reason static variabl may consid local access code reachabl main code reachabl singl run method class pass thread alloc the alloc outsid loop recurs procedur exampl variabl next static member class produc sinc variabl access code reachabl produc run method sinc one instanc produc creat analysi could determin next local produc thread case difficult clearli object contain variabl access stack static alloc variabl local specif thread case heap alloc variabl also local thread determin requir inform access heap object runtim lock reduct propos anoth techniqu virtual coarsen base java lock mechan transform updat variabl x instanc class c may made invis provid fobserv exist object x thread access x hold lock x x may instanc c contain x say lock x protect x intuit behind reduct that even though thread may access x cannot current thread releas lock x thu chang x need visibl lock releas correct reduct shown use diagram figur reason similar local variabl reduct assum nonloc variabl access protect lock thread whose code repres must hold lock variabl therefor although exist transform repres code thread access variabl transform cannot sequenc sinc thread would block reach transform assum f refer state share ob ject reduct allow us repres complex updat object two transform bound statement reachabl statement exist path program control flow graph ie thread might execut execut heap structur object programm object salarylock hourslock public class programm protect long hour protect doubl salari protect object hourslock new object protect object new object public void updatehourslong newhour synchron public void updatesalarydoubl newsalari synchron figur exampl split lock buffer exampl execut put get updat sever variabl yet repres call transform acquir lock transform atom updat state buffer releas lock order appli reduct need determin lock protect variabl clearli instanc variabl class access within synchron method class variabl protect lock object contain nevertheless common variabl protect lock object instanc bound buffer exampl array object referenc instanc variabl data protect lock enclos intbuff object common design pattern known contain object x conceptu nest object place refer x access x within method y anoth common design pattern lock protect variabl object split lock class might contain independ set instanc variabl may updat concurr case acquir lock entir instanc would excess limit potenti parallel instead set instanc variabl lock usual instanc root class object exampl given figur two thread could concurr updat programm hour salari gener determin lock protect variabl requir inform structur heap runtim collect inform topic next section refer analysi section describ static analysi algorithm construct approxim runtim heap struc ture collect inform need reduct understand runtim heap structur import problem compil optim sinc accur knowledg alias improv mani standard java allow physic nest object optim one common approach construct direct graph program statement repres finit conserv approxim heap structur control path end statement sever differ algorithm propos differ method approxim algorithm extens simpl algorithm given chase et al use basic approach extend chase algorithm three way first handl chase algorithm sequenti code second distinguish current summari heap node allow us collect inform onetoon relationship object third handl array program refer analysi repres multithread program set control flow graph cfg whose node repres statement whose arc repres possibl control step one cfg thread one cfg main method kc ident cfg run method class c recal kc instanc limit class c paper handl interprocedur anal ysi assum procedur method call inlin limit analysi program static bound recurs polymorph call inlin use switch statement branch base object type tag sinc tag model analysi method call might dispatch explor algorithm requir concept loop block statement s let loop innermost enclos loop statement nest within or null loop set fs jloop loopsg call loop block s analysi model refer variabl valu refer pointer heap object heap object contain fix number field refer heap object we model field refer type class instanc number field equal number instanc variabl refer type possibl zero array number field equal zero for array primit type one for array refer latter case array element repres singl field name java refer manipul four way new alloc return uniqu new refer field select field updat refer check equal thi last oper irrelev analysi storag structur graph storag structur graph ssg finit conserv approxim possibl pointer path heap particular statement s two type node ssg variabl node heap node one variabl node static alloc refer variabl stack alloc refer variabl scope s one two heap node alloc eg new c program depend locat statement relat a within loop block differ threadcfg a ssg contain current node a repres current instanc class cthe instanc alloc current iter as loop block statement s ssg contain summari node a repres x f f z f c c c class c class two field c xyz stack variabl method bodi figur ssg statement summar instanc class call instanc alloc complet iter as loop block heap node fix number field edg may direct edg ssg statement repres possibl refer valu s edg direct variabl node field heap node toward heap node gener one edg may leav variabl node heap node field sinc differ path may result differ valu refer even one path s may multipl edg leav summari node array field sinc node repres multipl variabl runtim exampl ssg shown figur elid part code relev analysi prepend line number simpl statement identif variabl node shown circl heap node rectangl slot field heap node label name class prefix statement number alloc summari node suffix asterisk thu c repres summari node alloc class c statement often omit disconnect node eg summari node alloc loop note link list repres self loop node c like chase et al distinguish object class alloc differ alloc heurist base observ object alloc given alloc tend treat similarli exampl employe meet object might contain nest date object alloc respect constructor ie two date alloc distinguish two kind date object analysi could determin date insid employe cannot affect date insid meet updat conserv ssg statement contain follow inform structur heap runtim exist edg node variabl x heap node alloc a execut path end ie execut thread cfg x may point object alloc a otherwis x cannot point object alloc a exist edg field f current heap node alloc b heap node alloc a execut path end s f field current instanc alloc b may point object alloc a otherwis f field current instanc alloc b cannot point object alloc a exist edg field f summari heap node alloc b heap node alloc a execut path end s f field summar instanc alloc b may point object alloc a otherwis summar instanc alloc b whose f field point object alloc a three case heap node alloc current node refer must current instanc alloc a otherwis refer summar instanc alloc a note use inform lack edg one graph precis anoth strict subset edg algorithm use modifi dataflow algorithm comput statement conserv ssg edg possi ble initi statement ssg edg worklist initi contain start statement main step statement remov head worklist process possibl updat ssg statement statement cfg edg ad statement ssg successor statement cfg depend statement cfg ad tail worklist one statement depend anoth may refer variabl runtim select static variabl instanc variabl algorithm termin worklist empti process statement employ three oper ssg join step summar first comput pre ssg statement join ssg immedi predecessor cfg ssg join take union edg set thi anypath analysi pre ssg updat step oper discuss below manner reflect semant statement produc postssg final statement last statement loop block postssg summar produc new version statement ssg otherwis postssg new version summar ssg redirect edg tofrom current node alloc within loop block correspond summari node see ssg statement figur step oper use abstract interpret updat ssg an abstract represent runtim heap accord statement semant assign refer variabl need consid statement cannot add edg ssg ie postssg equal pressg pointer express lvalu rvalu defin follow lvalu variabl variabl node lvalu field selector express xf set f field node rvalu x rvalu express set heap node point express lvalu or case alloc current node alloc semant assign whether left hand side stack variabl local static variabl e either stack variabl local static vari abl perform strong updat remov edg node lvalue ad edg node lvalue node rvalue otherwis perform weak updat simpli ad edg nodefield lvalue node rvalue edg ad statement ssg for step summar oper also ad ssg statement cfg assum thread may schedul arbitrarili thu statement anoth thread may wit refer valu execut thread alloc new threadx treat assign x special field runnabl thread object thi reflect inlin constructor thread let x set class object referenc x might belong ie subclass type x alloc process add worklist start statement everi cfg run method class x ie start statement cfg implicitli depend everi thread alloc might start thread cfg run method class c access instanc variabl current object eg express next produc run method figur rvalu set heap node class c point runnabl field heap node class thread ie associ given threadcfg specif thread alloc comput onetoon relationship summar inform gather analysi suffici lock reduct ssg edg summari node alloc summari node alloc b indic object alloc may point object alloc b need know object alloc point differ object alloc b would hold lock object protect variabl access nest b object conserv estim inform ssg summar updat follow edg summari node summari node b mark onetoon point differ b runtim b loop block edg field summari node summari node b first ad ssg summar oper mark onetoon field summari node subsequ updat step oper way anoth edg summari node b would ad edg longer mark onetoon method base observ nest object almost alway alloc loop block enclos object often enclos object con structor given constructor loop bodi alloc object alloc one nest object link object togeth onetoon relationship object record ssg arc current node alloc node summar end loop block inform preserv annot arc summari node fact motiv distinguish technic thread start start method call sinc use thread schedul informa tion assum thread start alloc produc ssg current summar instancesnod exampl consid java sourc figur first ssg figur postssg statement first time process ie summari inform exist second ssg result summar ssg note that sinc node b a summar togeth arc field b a label onetoon sinc a current node onetoon relationship field b a nor would loop ad around code a summar last ssg final ssg statement the end method statement thread alloc may access alloc statement statement field b may point alloc statement note stack variabl b scope statement thu remov ssg arc a a ad statement place worklist statement process although shown final ssg statement ssg would contain arc even though refer valu repres cannot appear statement thread schedul inform consid complex given program statement v variabl alloc algorithm must construct ssg contain ov node ov edg run time process statement at worst proport total number edg ssg number time statement process fixpoint reach thu worst case run time os v here number statement inlin procedur call could produc exponenti blowup number statement despit complex anticip cost refer analysi prohibit first base applic algorithm sever small exampl believ averag complex much lower ssg gener spars mani edg typic ssg would violat java type system could gener analysi also edg ad statement ssg process onc thu statement typic process time second v refer number model statement variablesin typic analysi fraction program mod ele refer analysi model variabl primit ie nonrefer type need model statement manipul variabl exclus also program requir might involv small subset program class rest program need repres appli reduct section explain use inform collect refer analysi appli local variabl lock reduct class implement runnabl a void run new a class a a new a class main static void main new a new ba inlin constructor new a new threadastart els x a x x a a a a a a final a a befor summari first iter a b b b after summari thread b figur refer analysi exampl local variabl reduct appli local variabl reduct straightforward set heap node ssg local given thread access stack static variabl local thread heap variabl access express form refid ref refer express id name instanc variabl variabl access express local thread node rvalu ref local thread pressg statement note heap variabl may local statement nonloc other common idiom object alloc initi made avail thread eg intbuff object exampl figur refer analysi determin instanc variabl object local object made avail thread lock reduct appli lock reduct complex need determin whether variabl protect lock gener relationship variabl lock protect may elabor determin static analysi here propos heurist believ wide applic and particular work lock design pattern given heurist assum relationship object contain variabl object contain lock match follow gener pattern either lock object access variabl object vice versa access third object lock variabl object pattern express term three role root lock variabl lock object contain lock variabl object contain variabl root object two object access role must play exactli one object one object may play multipl role express datai bound buffer exampl intbuff object root lock object int array referenc data variabl object express count intbuff object play three role express salari split lock exampl figur programm object play root variabl role object referenc salarylock play role lock consid static variabl field special environ object call env play role variabl root role lock gener pattern includ case lock object variabl object access static variabl case variabl static also fulli qualifi express prepend express access variabl current instanc prepend env static variabl access staticheap variabl want determin whether exist lock protect variabl ie thread access variabl must hold lock static variabl repres variabl node heap variabl field heap node lock heap node ssg essenti use express access variabl lock identifi lock object interpret express abstractli use ssg formal staticheap variabl v want comput protectv set lock protect v v let accessv set program express may access v set construct refer analysi express ev accessv comput protectv ev set lock thread hold ev protect v sinc lock must protect variabl everywher lock summari node variabl must field summari node interpret variabl object protect uniqu lock object given express ev access v comput lock express ev argument enclos synchron statement e defin tripl er root express common prefix e ev lock selector part e sv variabl selector part ev er final selector remov ie ersv refer object contain v v itself exam ple consid express hour method updatehour figur fulli qualifi express access variabl thishour lock express thishourslock pair yield tripl thi hourslock note indic lock root object same indic variabl root object same given ev er sv identifi candid lock ssg follow ssg node n selector s ns set node reach n follow s field object nsg set ssg node appli selector node may reach object contain variabl v first pressg ev comput set possibl root object ev s access v r contain exactli one node node candid root r comput set possibl lock pressg e l contain exactli one node node candid lock includ protectv ev deduc ssg that instanc v runtim uniqu instanc held thread note follow immedi sinc r ssg node path r r v might repres multipl object runtim nevertheless still conclud variabl repres v runtim uniqu lock repres follow true variabl repres v runtim uniqu root object repres r hold r current node arc path select sv onetoon arc summari node root object repres r runtim uniqu lock object repres analysi method inlin variabl replac new temporari hold implicit param eter addit simpl propag analysi use allow recognit pattern even multipl selector decompos seri assign eg xfg express hold provid current node arc path select onetoon arc summari node variabl v protect protectv nonempti transform may made invis fobserv variabl might access protect local note inaccuraci refer analysi lead larger model incorrect model cannot determin variabl local protect lock transform access variabl visibl transit system state still repres behavior possibl restrict program exampl consid bound buffer exampl figur ssg statement produc consum run method isomorph heap structur shown top figur there would also node stack variabl ssg deduc variabl next produc object local produc thread thu formula f depend next transform increment next may invis also bound buffer exampl variabl data array object instanc variabl intbuff class protect lock intbuff object thu formula depend variabl sequenc transform repres method put get may combin two transform one acquir lock updat variabl releas lock although complet program shown split lock exampl figur alloc programm would produc ssg subgraph isomorph heap structur shown top figur arc summari programm node object node would onetoon analysi could determin instanc variabl hour protect object access via field hourslock conclus propos method use static pointer analysi reduc size finitest model concurr java program method exploit two common design pattern java code data access one thread encapsul data protect lock process extract model sourc code must degre depend sourc languag although present restrict java mani aspect method wide applic could use reduc finitest model program heap data andor monitorlik synchron primit eg ada protect type method current implement part tool intend provid autom support extract finitest model java sourc code although empir data method perform time effect virtual coarsen reduc concurr model well known manual applic method sever small exampl suggest mani transit made invis typic formula arriv java concurr program enter mainstream finitest verif technolog offer power mean find concurr error often subtl difficult reproduc unfortun extract finitest model program requir exist verifi tediou errorpron result widespread use technolog unlik extract compact mathemat model real softwar artifact larg autom method like one describ essenti support extract acknowledg thank due georg avrunin help comment draft paper r formal properti parallel program autom analysi concurr system constrain express toolset composit verif model check counter exampl analysi pointer structur time analysi ada task pro gram protocol verif hardwar design aid use state space reduct method deadlock analysi ada task data flow analysi verifi properti concurr program element style analyz softwar design featur counterexampl detector concurr program java design principl pattern check finit state concurr program satisfi linear specifica tion static infinit wait anomali detect polynomi time tr integr concurr analysi softwar develop enviorn analysi pointer structur autom analysi concurr system constrain express toolset use state space reduct method deadlock analysi ada task data flow analysi verifi properti concurr program composit verif model check counterexampl element style time analysi ada task program check finit state concurr program satisfi linear specif concurr program java protocol verif hardwar design aid ctr jame c corbett matthew b dwyer john hatcliff shawn laubach corina s psreanu robbi hongjun zheng bandera extract finitest model java sourc code proceed nd intern confer softwar engin p june limerick ireland gleb naumovich georg s avrunin lori a clark data flow analysi check properti concurr java program proceed st intern confer softwar engin p may lo angel california unit state klau havelund mike lowri john penix formal analysi spacecraft control use spin ieee transact softwar engin v n p august gleb naumovich georg s avrunin lori a clark effici algorithm comput mhp jonathan aldrich emin gn sirer craig chamber susan j egger comprehens synchron elimin java scienc comput program v n p may jongdeok choi manish gupta mauricio serrano vugranam c sreedhar sam midkiff escap analysi java acm sigplan notic v n p oct pramod v koppol richard h carver kuochung tai increment integr test concurr program ieee transact softwar engin v n p june jame c corbett use shape analysi reduc finitest model concurr java program acm transact softwar engin methodolog tosem v n p jan john whaley martin rinard composit pointer escap analysi java program acm sigplan notic v n p oct jongdeok choi manish gupta mauricio j serrano vugranam c sreedhar samuel p midkiff stack alloc synchron optim java use escap analysi acm transact program languag system topla v n p novemb premkumar t devanbu stuart stubblebin softwar engin secur roadmap proceed confer futur softwar engin p june limerick ireland john penix willem visser seungjoon park corina pasareanu eric engstrom aaron larson nichola weining verifi time partit deo schedul kernel formal method system design v n p march