t local orderinvari firstord formula a queri local decis whether tupl structur satisfi queri depend small neighborhood tupl prove queri express orderinvari firstord formula local b introduct one fundament properti firstord formula local mean decis whether fix structur formula hold point or tupl point depend small neighborhood point tupl result prove gaifman give good intuit express power firstord logic particular provid conveni proof certain queri cannot express firstord formula exampl decid whether path two vertic graph clearli suffic look small neighborhood vertic henc local stconnect express firstord logic re centli libkin other systemat start explor local tool prove inexpress result ultim goal line research would separ complex class particular separ tc is class languag recogn uniform famili boundeddepth circuit major gate logspac howev recent result hella show even uniform ac contain nonloc queri destroy hope nevertheless local remain import tool prove inexpress result queri languag databas theori one often face situat physic represent databas consid relat structur induc order structur order hidden user user may use order queri result queri depend given order word user may use fact order there sinc know one cannot make queri depend particular order may seem help her actual firstord formula use order express orderinvari queri cannot express without order unpublish result due gurevich exampl queri refer reader exampl due formal say firstord formula x whose vocabulari contain order symbol orderinvari class c structur structur c tupl element a linear order have a hold if if a hold easi consequ interpol theorem formula orderinvari class structur equival firstord formula use order longer true restrict class finit structur class consist singl infinit structur unfortun case show natur applic comput scienc prove class c structur firstord formula order invari c defin queri local structur c pure firstord logic properti local give us good intuit express power orderinvari firstord formula simpl method prove inexpress result paper organ follow preliminari prove local orderinvari firstord formula one free variabl section crucial step toward main result follow section reduc case formula arbitrarili mani variabl onevari case would like thank juha nurmonen point us problem clemen lautemann fruit discuss solut preliminari vocabulari set contain finit mani relat constant symbol structur consist set a call univers a interpret r r rari relat symbol r interpret c constant exampl graph consid fegstructur e binari relat symbol order structur structur whose vocabulari contain distinguish binari relat symbol interpret linear order univers denot set integ occasion need consid string finit structur l let l denot vocabulari f constant symbol min max repres string lletter alphabet order l structur univers n p j interpret g everi j notat distinguish string represent finit structur s given l refer string lstring structur b subset contain constant a induc substructur univers b denot hbi let oe ae vocabulari oereduct structur a denot aj oe oestructur univers symbol oe interpret a hand structur aj call expans b oestructur b relat r expans b suitabl vocabulari oe oe contain addit symbol oe new k ari relat symbol new constant symbol class structur kari queri c map ae assign kari relat structur c isomorph structur isomorph f b also isomorph expand structur a aea b aeb boolean or ari queri c subclass c close isomorph type game equival firstord logic character term follow ehren definit let r a structur vocabulari rround ef game a play two player call spoiler duplic r round game spoiler either choos element v element v duplic answer choos element v element v a respect duplic win game map map v v constant c correspond constant c partial isomorph is isomorph substructur gener domain substructur gener imag clear defin notion win strategi duplic game quantifierdepth firstord formula maxim number nest quantifi formula rtype structur set firstord sentenc quantifierdepth r satisfi a wellknown fact vocabulari finit number distinct rtype structur simpli finit mani inequival firstord formula vocabulari quantifi depth r write r denot rtype theorem let r a structur vocabulari r if if duplic win strategi rround efgam a follow two simpl exampl need later may serv exercis reader prove nonexpress result use efgam exampl let r use rround efgam hard see string rtype impli exampl class f n cannot defin firstord sentenc exampl may consid boolean algebra structur vocabulari ft u g particular let pn denot powerset algebra n hard prove r exist n pn r pn thu class eveng cannot defin firstord sentenc applic conveni modifi efgam follow instead choos element round game spoiler may also decid skip round case v v remain undefin may also write v cours undefin v consid decis whether duplic win obviou duplic win strategi rround modifi efgam a if if win strategi origin rround efgam order invari firstord logic definit let vocabulari contain c class struc ture formula x vocabulari fg orderinvari c linear order order invari class fag also say orderinvari a simplifi notat fgformula x orderinvari class c structur c write j inv a denot some henc order a a furthermor say x defin queri fa j j inv ag c easili extend definit boolean queri let us emphas that although orderinvari firstord logic sound like restrict pure firstord logic actual extens queri class finit structur defin orderinvari firstord formula pure firstord formula follow exampl found exampl orderinvari firstord sentenc vocabulari defin queri fpn j n eveng class finit boolean algebra exampl queri defin firstord logic similarli let disjoint union structur pn n unari queri x belong compon even number atom fag defin orderinvari firstord formula plain firstord formula local formula let structur gaifman graph graph univers adjac relat symbol r tupl c r c b occur c distanc a b two element defin length shortest path b gaifman graph a path exist let a ffibal around defin set b a b ffig ffispher set ffig clear context usual omit superscript set b c let db b tupl let ambigu x also defin queri class fgstructur speak queri defin orderinvari formula alway refer queri defin text definit kari queri ae class c local exist c least call local rank ae orderinvari class c local queri defin local local rank x local rank queri emphas that definit local orderinvari formula neither isomorph distanc function refer linear order gaifman prove firstord formula defin local queri local invari formula one free variabl section go show firstord formula one free variabl orderinvari class c structur also local c formal state prove result need prepar lemma l r n mn n lstring size least n unari relat p p proof let l r n fix number rtype vocabulari l let choos n larg enough whenev edg complet graph n vertic color color induc subgraph size whose edg color lstring length n n denot lsubstr color pair fi jg that is edg fi jg complet graph n rtype the represent of hi ji choic n find structur hp rtype let g claim s p intuit prove claim carri win strategi duplic string structur recal exampl strategi exist formal proceed follow defin map f consid rround efgam s p usual let v v element chosen round i difficult prove induct i duplic play way everi r one follow condit hold follow two subcondit hold a duplic win strategi r gamma iround modifi efgam u fv b duplic win strategi r gamma iround modifi ef game hp fv ident hp fv els g ident hp fv clearli impli claim thu statement lemma lemma firstord formula x orderinvari class c structur local c proof let x firstord formula quantifierdepth r orderinvari class c structur let l number differ rtype vocabulari q new unari relat symbol let l l let n given lemma wrt r l let n r b via isomorph goal show linear order b conclud order prove exist linear order first show that wlog assum follow set w fa bg automorph ae hb w i show thi distinguish follow two case case simpli set w fa bg defin ae case assum first da a also db a furthermor choic b a b conclud proof given if hand da everi i set henc assum follow make use b a oppos b a easi see everi sphere w disjoint union orbit ae ie disjoint union set form fix everi linear order orbit sphere w next fix preorder oe follow properti oe linear order sphere w orbit c come orbit c order orbit chosen abov c c relat respect oe whenev c c orbit linear order refin oe differ insid orbit assum sphere w empti otherwis b w would union connect compon a henc could fix linear order orbit b w defin combin oe combin imag ae oe orbit o fix vertex vo defin linear order finit delta ae infinit everi k denot k imag ae k easi see s w catch intuit idea proof reader pictur sphere w for sequenc concentr cycl w innermost outsid cycl rest structur a fix order oe automorph ae turn cycl say clockwis particular turn cycl w far enough map b cycl order clockwis order k result turn cycl kstep unfortun exactli true usual orbit form whole sphere may form small cycl infinit cycl essenti right pictur defin order proceed follow w let look look b be hand outermost cycl w order same outsid structur fix let w for fix begin proof determin two sequenc alreadi know j w reach j turn one step is let j w stick thi reach j w turn let go like thi last turn jm w want similarli defin start take turn sphere end sphere k w cours turn detect hide took one turn defin idea consid sequenc sphere long string whose letter type sphere posit turn taken consid unari predic string lemma find unari predic size respect expans string predic indistinguish exactli need essenti do cours nasti detail everi substructur induc sphere ihgammaj w let everi structur let linear order j defin combin order j sphere oe final let e j linear order obtain combin oe sphere q w q ih j sphere q w q ih everi everi i defin unari relat q icj w ie vertex v q j distanc central sphere j defin lstring l enumer pair rtype gstructur set pair rtype t lemma choic paramet l exist unari relat duplic win strategi rround game s p s p readi defin linear order a everi i let defin ui p e ui defin ui observ that although i disjoint definit consist remain show duplic win strategi rround game b win strategi duplic obtain transfer win strategi s p s p make use gap preserv techniqu invent everi fi fl defin function f fifl x go show duplic play way everi follow condit hold exist fi vertic q fifl one success superspher gap rgammai sphere contain chosen vertic duplic r gamma iround win strategi modifi game s everi fifl duplic rgammairound win strategi modifi game structur t f fifl v j everi everi refer element element element b gammafi w middl element other outer element first show conclud condit duplic win strategi let v r element chosen game let j k r show a v b map b v v r partial isomorph c k a follow immedi rememb definit sphere a impli element sphere succeed sphere relat relat a henc v j v k group element ie inner middl outer b follow immedi ensur properti fi fl ensur v k group v j v k respect c follow similar reason middl outer inner element b c follow immedi respect remain show induct i hold everi r immedi hold lemma true wlog spoiler select vertex v a the case choos v complet analog condit symmetr let fi denot valu fi fl obtain distinguish follow case case choos immedi hold induct case also choos subcas induct element z duplic win strategi r gamma i round game s rtype f fifl v z p either two substructur linear order type j j j j linear order type j j either case exist element v z hold choic z also follow hold v v q p hold outer structur noth chang final still hold b fl w affect either induct hypothesi duplic r win strategi modifi game structur t f fifl v j henc v still r gamma iround win strategi modifi game structur t f fifl v j t f fifl v impli immedi lie former gap subcas case choos case choos exist appropri v follow case analog ii condit ensur exist win strategi also buffer zone case handl second subcas iii case fi fl chosen way first subcas iii v chosen aev henc hold simpli choos v immedi case fi remark later refer let us observ lemma impli statement local rank x c bound function vocabulari quantifierdepth x precis vocabulari r r follow hold firstord formula x vocabulari quantifierdepth r orderinvari class c structur local c local rank to see follow lemma let c class structur x orderinvari rememb finit mani firstord formula vocabulari quantifierdepth r local invari formula arbitrarili mani free variabl lemma let vocabulari r k exist follow hold x firstord formula vocabulari quantifierdepth r orderinvari structur a proof first give sketch proof proof induct k lemma restat local orderinvari firstord formula one free variabl prove lemma k assum ktupl a b j far apart as hypothesi lemma requir isomorph suffici larg prove b cannot distinguish orderinvari formula vocabulari quantifierdepth r distinguish three case first b say b k far away a treat constant appli lemma show k b k cannot distinguish expand structur a here use hypothesi da treat b k constant appli induct hypothesi prove cannot distinguish expand structur a b k thi requir hypothesi second case similar assum h iter partial isomorph h map far away a first show h a cannot distinguish h a b cannot distinguish third case h entir tupl h a close a restrict automorph substructur map b modifi substructur way tupl b encod singl element appli lemma describ proof detail note befor prove lemma induct k follow lemma recal remark see r function r suppos statement lemma prove let vocabulari r let binari relat symbol contain let let structur db shall prove let isomorph hb ai hb bi k j k without loss gener assum k properti use hypothesi note formula orderinvari structur sinc assum greater equal induct hypothesi next note fd gstructur use hypothesi similar argument show impli case case hold z z k choos z properti jzj least possibl assum without loss gener j k suffic prove case similar argument show yield case z z k j k d z a note z z domain contain b z a domain b a z a j automorph substructur hbi binari relat symbol contain expand note remain automorph hbi e thu z z furthermor orderinvari e henc choic thu theorem everi firstord formula orderinvari class c structur local c proof first give sketch proof proof induct number k free variabl formula alreadi prove formula one free variabl local invari c c a b k hb ai suffici larg either j b far apart appli lemma close togeth latter case defin new structur encod pair element close togeth new element spoil distanc much encod ktupl smaller tupl still isomorph neighborhood appli induct hypothesi formal prove follow statement induct k let vocabulari r k firstord formula vocabulari quantifi depth r structur have orderinvari a local localityrank follow lemma cf remark suppos prove firstord formula vocabulari quantifi rank r order invari structur a choos accord lemma let r binari relat symbol contain g let let b structur obtain ad new vertex r edg ba r edg ba note a b furthermor ij orderinvari b thu induct hypothesi local b local rank k a lemma without loss gener assum da sinc also b consid structur ba a henc definit b thu impli research obviou question follow result is els ad firstord logic remain local hella prove invari firstord formula use order also addit multipl local hand conjectur ad order addit destroy local howev fact invari formula builtin addit multipl local relev complex theori sinc firstord logic builtin addit multipl captur uniform ac one way appli local techniqu complex theoret question spite hella nonloc result weaken notion local exampl conceiv invari ac even queri local sens two point structur size n isomorph neighborhood radiu olog n indistinguish would still suffici separ logspac class r foundat databas extend ordergener queri local properti queri languag finit model theori local nonloc properti privat commun privat commun notion local logic character finit model form local finit model count local properti graph connect monad np tr logic count local properti foundat databas local properti queri languag decid firstord properti local treedecomposalb graph form local finit model logic aggreg oper logic count auxiliari relat lower bound invari queri ctr david grossamblard querypreserv watermark relat databas xml document proceed twentysecond acm sigmodsigactsigart symposium principl databas system p june san diego california leonid libkin express power sql theoret comput scienc v n p march leonid libkin logic captur local properti acm transact comput logic tocl v n p jan guozhu dong leonid libkin limsoon wong increment recomput local languag inform comput v n p march nicol schweikardt express power monad least fix point logic theoret comput scienc v n p februari lane a hemaspaandra sigact news complex theori column acm sigact new v n decemb